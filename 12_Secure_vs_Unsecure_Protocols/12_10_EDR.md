| **Inicio**         | **atr√°s 9**                  | **Siguiente 11**     |
| ------------------ | ---------------------------- | -------------------- |
| [üè†](../README.md) | [‚è™](./12_9_Anti_malware.md) | [‚è©](./12_11_DLP.md) |

---

## **√çndice**

| Temario                                                                                                            |
| ------------------------------------------------------------------------------------------------------------------ |
| [375. ¬øQu√© es la detecci√≥n y respuesta de puntos finales?](#375-qu√©-es-la-detecci√≥n-y-respuesta-de-puntos-finales) |
| [376. ¬øQu√© es la detecci√≥n y respuesta en endpoints (EDR)?](#376-qu√©-es-la-detecci√≥n-y-respuesta-en-endpoints-edr) |

# **EDR**

## **375. ¬øQu√© es la detecci√≥n y respuesta de puntos finales?**

![EDR](/img/12_Secure_vs_Unsecure_Protocols/EDR.png "EDR")

**EDR (Endpoint Detection and Response)** es una tecnolog√≠a de **ciberseguridad avanzada** que protege a los **puntos finales** (computadoras, laptops, servidores, dispositivos m√≥viles) de **ataques modernos**.

A diferencia de un **antivirus tradicional**, que solo busca malware conocido, el EDR **detecta, investiga y responde en tiempo real** a comportamientos sospechosos en los endpoints.

üëâ Piensa en EDR como un **‚Äúsistema de c√°maras de seguridad + guardias‚Äù** en tu laptop o servidor:

- El antivirus detecta si alguien ya entr√≥ (malware conocido).
- El EDR detecta **c√≥mo entr√≥, qu√© hizo, y lo bloquea incluso si era desconocido**.

### ‚öôÔ∏è ¬øC√≥mo funciona EDR?

El flujo t√≠pico de un EDR es este:

1. **Monitorizaci√≥n continua del endpoint**

   - Recolecta telemetr√≠a: procesos, archivos, conexiones de red, accesos a memoria, logs.
   - Ejemplo: detecta si un `powershell.exe` abre cientos de archivos `.docx` en segundos (patr√≥n de ransomware).

2. **An√°lisis de comportamiento**

   - Aplica reglas, heur√≠stica, machine learning o IOCs (Indicadores de Compromiso).
   - Ejemplo: detecta que un proceso intenta inyectarse en `explorer.exe`.

3. **Detecci√≥n de incidentes**

   - Genera una alerta cuando una actividad coincide con un patr√≥n malicioso.
   - Ejemplo: conexi√≥n de tu endpoint a una IP C2 (Comando y Control) en Rusia.

4. **Respuesta automatizada o manual**

   - Puede **aislar el endpoint**, **matar procesos**, **borrar/quarantena archivos**.
   - El analista de seguridad puede investigar y tomar acciones desde la consola central.

5. **Forense y remediaci√≥n**

   - El EDR guarda evidencias (hashes, logs, tr√°fico) para analizar el ataque y mejorar la defensa.

### üîë Funciones clave de un EDR

- **Detecci√≥n avanzada**: no solo firmas, tambi√©n comportamiento y ML.
- **Monitoreo en tiempo real**: vigila procesos, memoria, red, registros.
- **Respuestas autom√°ticas**: aislar host, bloquear procesos, eliminar malware.
- **Investigaci√≥n forense**: recolecta evidencia para entender c√≥mo ocurri√≥ el ataque.
- **Telemetr√≠a centralizada**: todos los endpoints reportan a un servidor/nube.
- **Threat Hunting**: los analistas pueden buscar indicadores (hashes, dominios, IPs) en todos los endpoints.
- **Integraci√≥n con SIEM/SOAR**: conecta con otras herramientas para respuesta automatizada.

### üîç ¬øQu√© debes buscar en una soluci√≥n EDR?

Al elegir un EDR, considera:

1. **Cobertura multiplataforma**: Windows, Linux, macOS, m√≥viles.
2. **Capacidad de respuesta autom√°tica**: aislamiento, bloqueo, rollback.
3. **Bajo consumo de recursos** (no debe ralentizar PCs).
4. **Visibilidad completa**: procesos, memoria, red, usuarios.
5. **Integraci√≥n en la nube**: telemetr√≠a centralizada y an√°lisis en tiempo real.
6. **Threat intelligence**: actualizaci√≥n continua de IOCs y TTPs (MITRE ATT\&CK).
7. **Facilidad de uso**: consola clara para SOC o administradores.
8. **Soporte a investigaciones**: exportaci√≥n de logs y compatibilidad con SIEM.

Ejemplos de EDRs conocidos:

- Microsoft Defender for Endpoint
- CrowdStrike Falcon
- SentinelOne
- Sophos Intercept X
- Palo Alto Cortex XDR

### üåç ¬øPor qu√© es importante el EDR?

1. **Los antivirus tradicionales no son suficientes**:

   - Malware moderno usa t√©cnicas _fileless_, _living-off-the-land_ (LOLbins) o ataques de d√≠a cero.
   - El EDR detecta actividad sospechosa aunque el malware no tenga firma.

2. **Detecci√≥n temprana de ransomware**:

   - El EDR puede detener un ransomware en segundos al detectar un comportamiento masivo de cifrado.

3. **Respuesta r√°pida a incidentes**:

   - Permite aislar el endpoint afectado antes de que se propague el ataque en la red.

4. **Soporte forense**:

   - Guarda evidencia de c√≥mo entr√≥ el atacante, qu√© hizo y qu√© informaci√≥n pudo robar.

5. **Cumplimiento normativo** (ISO 27001, NIST, GDPR):

   - Muchas normas exigen monitoreo y detecci√≥n continua en endpoints.

### üñ•Ô∏è Ejemplo pr√°ctico (caso de ransomware con EDR)

üìå Escenario:

Un usuario abre un adjunto malicioso `factura.pdf.exe`.

üîé Lo que hace el EDR:

1. Detecta que `factura.pdf.exe` lanza `powershell.exe`.
2. Observa que `powershell.exe` descarga un script de una IP sospechosa.
3. Detecta un patr√≥n de encriptaci√≥n masiva de archivos `.docx`.
4. Bloquea el proceso inmediatamente.
5. A√≠sla la laptop de la red para evitar propagaci√≥n.
6. Env√≠a un log al SOC con evidencia: hash del archivo, IP de C2, usuario afectado.
7. El analista revisa y confirma incidente ‚Üí remediaci√≥n ‚Üí backup/restore.

üëâ Sin EDR, probablemente el ransomware habr√≠a cifrado toda la red.

‚úÖ **Resumen final**

El **EDR es la evoluci√≥n del antivirus tradicional**:

- No solo detecta, tambi√©n responde y recolecta evidencias.
- Es esencial en **empresas, SOCs y entornos cr√≠ticos** para frenar ataques modernos.
- Combinado con SIEM/SOAR ‚Üí se convierte en una soluci√≥n **XDR** (detecci√≥n y respuesta extendida).

---

[üîº](#√≠ndice)

---

## **376. ¬øQu√© es la detecci√≥n y respuesta en endpoints (EDR)?**

**EDR** es una soluci√≥n de seguridad para endpoints (PCs, laptops, servidores, dispositivos m√≥viles) que **monitoriza continuamente** la actividad local, **detecta comportamientos sospechosos** y **proporciona capacidades de respuesta** (aislar, matar procesos, recopilar evidencia, remediar).

No es solo ‚Äúantivirus‚Äù; es una plataforma que aporta **visibilidad profunda**, **telemetr√≠a** y **acci√≥n** para frenar ataques modernos (ransomware, fileless, lateral movement, exfiltraci√≥n).

### ¬øC√≥mo funciona EDR? (flujo general)

1. **Agente ligero** en cada endpoint recoge telemetr√≠a: procesos, comportamiento en memoria, conexiones de red, archivos, registros del sistema, eventos de PowerShell, cambios en el registro, etc.
2. Los datos se env√≠an a una **consola central** (on-prem o nube) donde se analizan en tiempo real con reglas, ML y threat intelligence.
3. Cuando algo coincide con una regla o comportamiento malicioso, el sistema **genera una alerta** y puede ejecutar **acciones autom√°ticas** (aislar, bloquear, matar).
4. Los analistas usan la consola para **investigar** (ver √°rbol de procesos, timeline, artefactos), ejecutar respuestas adicionales y orquestar contenciones remotas.
5. La plataforma almacena evidencia para **forense** y mejora sus reglas (y dustribuye IOCs a todos los endpoints).

### Componentes clave de una soluci√≥n EDR

- **Agente / Sensor**: recolecta y aplica pol√≠ticas en el endpoint.
- **Telemetr√≠a**: logs de procesos, autopsias en memoria, conexiones, hashes, archivos creados/eliminados.
- **Motor de detecci√≥n**: reglas, heur√≠stica, ML, correlaci√≥n con IOCs.
- **Consola central / UI**: vistas de alerta, timeline, b√∫squedas (hunt).
- **Capacidades de respuesta**: aislamiento de red, matar procesos, bloquear hash/domains/IP, despliegue de scripts, rollback de cambios.
- **Integraciones**: SIEM, SOAR, threat intel feeds, IAM, MDM, herramientas de patching.

### Funciones y capacidades (con ejemplos)

- **Detecci√≥n en tiempo real**: p.ej. detectar un `powershell.exe` que ejecuta comandos ofuscados.
- **Investigaci√≥n (forense)**: ver √°rbol de procesos y ‚Äúplayback‚Äù de lo que hizo un ejecutable (files, registry, network).
- **Respuesta remota**: aislar el host de la red con un click; ejecutar un kill / quarantine.
- **Threat hunting**: buscar un hash o un comportamiento en todo el parque de endpoints.
- **Rollback / remediation**: restaurar archivos cifrados (si el EDR tiene snapshots) o aplicar scripts de limpieza.
- **Automatizaci√≥n**: crear playbooks que al detectar X autom√°ticamente ejecuten Y.

### Ejemplos de detecciones t√≠picas (y qu√© hacen)

1. **Ransomware ‚Äî comportamiento**

   - Se√±al: proceso que abre o renombra cientos de archivos en poco tiempo y escribe extensiones nuevas (.locked).
   - Acci√≥n EDR: bloquear proceso, aislar host, snapshot/restaurar, alertar SOC.

2. **Credential dumping (p.ej. Mimikatz)**

   - Se√±al: proceso lee lsass.exe o usa API t√≠picas de dump de credenciales.
   - Acci√≥n EDR: detener proceso, recolectar memoria para forense, bloquear lateralidad (bloquear cuentas) y cambiar credenciales comprometidas.

3. **Living-off-the-land (PowerShell / WMI abuse)**

   - Se√±al: PowerShell con comandos ofuscados invocando web requests y ejecutando scripts en memoria.
   - Acci√≥n EDR: matar proceso, recolectar script, bloquear IP/URL, buscar IOCs en otros endpoints.

4. **Lateral movement**

   - Se√±al: conexiones SMB/RPC inusuales entre hosts, creaci√≥n de servicios remotos, uso de PsExec.
   - Acci√≥n EDR: aislar host origen, revocar sesiones y bloquear cuentas implicadas.

### Ejemplo de timeline de un incidente y acciones EDR

1. 09:02 ‚Äî Usuario abre adjunto malicioso.
2. 09:03 ‚Äî Agente EDR detecta que `word.exe` lanza `powershell.exe` con comando ofuscado ‚Üí **alerta autom√°tica**.
3. 09:03 ‚Äî Playbook autom√°tico: **aislar host** de la red y **matar** `powershell.exe`.
4. 09:05 ‚Äî Consola SOC muestra √°rbol de procesos, hashes y conexiones; analista confirma C2 contact.
5. 09:10 ‚Äî SOC ejecuta ‚Äúhunt‚Äù por hash en toda la flota; despliega bloqueo de hash y IOC.
6. 09:30 ‚Äî Remediaci√≥n: limpieza del endpoint, restauraci√≥n desde backup y rotaci√≥n de credenciales del usuario afectado.
7. 10:00 ‚Äî Reporte y lecciones: actualizar reglas EDR y bloquear el dominio usado por C2.

### Ejemplo pr√°ctico (regla simple / Sigma para detectar PowerShell sospechoso)

Sigma (est√°ndar para detecciones ‚Äî legible por humanos):

```yaml
title: Suspicious PowerShell Execution with Download
id: 12345678-1234-1234-1234-1234567890ab
description: Detects PowerShell execution with suspicious download and execution patterns
detection:
  selection:
    Image|endswith: '\powershell.exe'
    CommandLine|contains:
      - "-enc"
      - "IEX"
      - "Invoke-Expression"
  condition: selection
level: high
```

- En un EDR real esto se traduce a una regla que generar√° alerta y/o ejecutar√° un playbook.

### Qu√© buscar al evaluar una soluci√≥n EDR

- **Visibilidad completa**: procesos, memoria, red y persistencia.
- **Capacidad de respuesta**: aislar, bloquear, rollback, ejecutar scripts remotos.
- **Escalabilidad y rendimiento**: cantidad de endpoints, latencia y consumo.
- **Threat intelligence y MITRE ATT\&CK mapping**: mapeo de TTPs y feeds actualizados.
- **Funcionalidad de hunt**: b√∫squeda hist√≥rica y queries ad hoc.
- **Integraci√≥n**: SIEM, SOAR, IAM, MDM, herramientas de backup.
- **Retenci√≥n de datos**: cu√°nto hist√≥rico guarda para forense (d√≠as/meses).
- **Falso positivo y tuning**: facilidad para crear/excluir excepciones.
- **Automatizaci√≥n y playbooks**: orquestaci√≥n sin intervenci√≥n humana cuando es apropiado.

### EDR vs Antivirus / NGAV / XDR (resumen)

- **Antivirus cl√°sico**: firma-based, protecci√≥n b√°sica.
- **NGAV** (Next-Gen AV): a√±ade ML & behavioral detection.
- **EDR**: adem√°s de detecci√≥n a√±ade **respuesta, telemetr√≠a y forense**.
- **XDR** (Extended Detection & Response): expande EDR a red, nube, correo y otros telemetrys para una visi√≥n correlacionada.

### Limitaciones y retos de EDR

- **Falsos positivos**: requieren tuning y procesos de validaci√≥n.
- **Privacidad / legal**: recolecci√≥n de telemetr√≠a puede generar implicaciones legales; definir pol√≠ticas.
- **Coste / recursos**: licencias, almacenamiento y analistas.
- **Dependencia de logs**: si el endpoint es comprometido profundamente, el agente podr√≠a ser deshabilitado (se necesitan controles tamper-proof).

### Playbook de respuesta b√°sico (acciones t√≠picas que orquesta un EDR)

1. **Detecci√≥n** ‚Üí generar alerta y enriquecer con contexto (user, host, proceso, hash, IP).
2. **Contenci√≥n autom√°tica (opcional)** ‚Üí aislar host, bloquear hash/IP/domain, matar proceso.
3. **Recolecci√≥n** ‚Üí volcar memoria, recopilar archivos, eventos y snapshots.
4. **An√°lisis** ‚Üí SOC analiza evidencia y determina alcance.
5. **Erradicaci√≥n** ‚Üí limpieza, eliminaci√≥n de persistencia, desplegar parches.
6. **Recuperaci√≥n** ‚Üí restaurar desde backup, validar integridad.
7. **Lecciones aprendidas** ‚Üí ajustar detecciones, reforzar controles y comunicar.

### M√©tricas √∫tiles para evaluar EDR

- **MTTD** (Mean Time To Detect) ‚Äî tiempo medio en detectar.
- **MTTR** (Mean Time To Remediate) ‚Äî tiempo medio en remediar.
- **N√∫mero de hosts aislados y tiempo de aislamiento**.
- **N√∫mero de eventos/alertas por d√≠a y tasa de falsos positivos**.
- **Cobertura de MITRE ATT\&CK** (qu√© t√©cnicas detecta).

### Conclusi√≥n ‚Äî por qu√© EDR importa

EDR es hoy imprescindible para organizaciones que quieren **detectar r√°pidamente amenazas avanzadas**, **contenerlas** y **recopilar evidencia** para remediar y prevenir escaladas. Proporciona la visibilidad operativa y las herramientas de respuesta necesarias para frenar ataques que el antivirus tradicional no puede manejar por s√≠ solo.

---

[üîº](#√≠ndice)

---

| **Inicio**         | **atr√°s 9**                  | **Siguiente 11**     |
| ------------------ | ---------------------------- | -------------------- |
| [üè†](../README.md) | [‚è™](./12_9_Anti_malware.md) | [‚è©](./12_11_DLP.md) |
