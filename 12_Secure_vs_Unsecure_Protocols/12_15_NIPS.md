| **Inicio**         | **atr√°s 14**          | **Siguiente 16**                     |
| ------------------ | --------------------- | ------------------------------------ |
| [üè†](../README.md) | [‚è™](./12_14_NIDS.md) | [‚è©](./12_16_Host_based_Firewall.md) |

---

## **√çndice**

| Temario                                                                                                                 |
| ----------------------------------------------------------------------------------------------------------------------- |
| [385. ¬øQu√© es un sistema de prevenci√≥n de intrusiones?](#385-qu√©-es-un-sistema-de-prevenci√≥n-de-intrusiones)            |
| [386. Prevenci√≥n de intrusiones - SY0-601 CompTIA Security+](#386-prevenci√≥n-de-intrusiones---sy0-601-comptia-security) |

# **NIPS**

## **385. ¬øQu√© es un sistema de prevenci√≥n de intrusiones?**

![NIPS](/img/12_Secure_vs_Unsecure_Protocols/NIPS.jpg "NIPS")

Un **IPS (Intrusion Prevention System)** es una soluci√≥n de seguridad que **monitorea el tr√°fico de red en tiempo real, detecta actividades maliciosas y las bloquea autom√°ticamente** antes de que causen da√±o.

üëâ A diferencia de un **IDS (Intrusion Detection System)**, que solo detecta y alerta, el **IPS act√∫a de forma activa** para detener el ataque.

üìå Ejemplo:

- Si un atacante lanza un **ataque de fuerza bruta SSH**, el IPS no solo genera una alerta, sino que **bloquea la IP maliciosa** inmediatamente.

### ‚öôÔ∏è ¬øC√≥mo funcionan los sistemas de prevenci√≥n de intrusiones?

El funcionamiento de un IPS se puede dividir en pasos:

1. **Monitoreo del tr√°fico**

   - El IPS se ubica en l√≠nea entre el firewall y la red interna, inspeccionando cada paquete.

2. **An√°lisis del tr√°fico**

   - Usa m√©todos de detecci√≥n (firmas, anomal√≠as, comportamiento, heur√≠stica).

3. **Acci√≥n preventiva**

   - Si detecta una amenaza, puede:

     - Bloquear el paquete sospechoso.
     - Terminar la conexi√≥n.
     - Aislar al host afectado.

4. **Generaci√≥n de reportes y logs**

   - Registra detalles del ataque para auditor√≠a y an√°lisis forense.

üìå Ejemplo pr√°ctico:

- Un usuario intenta inyectar un comando SQL en una aplicaci√≥n web (`' OR '1'='1`).
- El IPS detecta el patr√≥n de **SQL Injection** y **bloquea la petici√≥n** antes de que llegue al servidor.

### üß© Tipos de sistemas de prevenci√≥n de intrusiones

Existen varios tipos seg√∫n su enfoque:

1. **NIPS (Network-based IPS)** üåê

   - Analiza el tr√°fico de red completo.
   - Ejemplo: detectar un **ataque DDoS** contra un servidor web.

2. **HIPS (Host-based IPS)** üíª

   - Se instala en un host individual (servidor, PC).
   - Ejemplo: bloquear un proceso sospechoso en Windows que intenta modificar el registro.

3. **WIPS (Wireless IPS)** üì∂

   - Protege redes Wi-Fi contra ataques como **rogue access points** o sniffing.
   - Ejemplo: bloquear un punto de acceso no autorizado en una oficina.

4. **NBA (Network Behavior Analysis)** üìä

   - Analiza el comportamiento del tr√°fico y detecta anomal√≠as.
   - Ejemplo: detectar que una m√°quina infectada est√° enviando tr√°fico masivo hacia el exterior (botnet).

### üéØ Beneficios de los sistemas de prevenci√≥n de intrusiones

1. **Bloqueo en tiempo real** de ataques antes de que lleguen al sistema.
2. **Protecci√≥n contra amenazas conocidas y desconocidas** (dependiendo del motor de detecci√≥n).
3. **Reducci√≥n de riesgos internos** (ataques de empleados malintencionados).
4. **Cumplimiento normativo** (PCI DSS, HIPAA, ISO 27001 requieren controles de detecci√≥n/preventivos).
5. **Visibilidad del tr√°fico de red** ‚Üí ayuda en auditor√≠as y forense digital.

üìå Ejemplo:

- Una empresa de salud con IPS puede evitar que datos de pacientes sean exfiltrados mediante un malware.

### üîë Caracter√≠sticas cr√≠ticas de un IPS

- **Inspecci√≥n profunda de paquetes (DPI)**: analiza hasta la capa de aplicaci√≥n (HTTP, DNS, SMTP).
- **M√∫ltiples t√©cnicas de detecci√≥n**: firmas, anomal√≠as, reputaci√≥n de IPs, machine learning.
- **Capacidad de respuesta autom√°tica**: bloquear, aislar, desconectar.
- **Actualizaciones en tiempo real** de reglas y firmas.
- **Integraci√≥n con SIEM y firewalls de nueva generaci√≥n (NGFW)**.
- **Escalabilidad** para manejar alto volumen de tr√°fico sin generar latencia.

### ü§ñ Aprendizaje profundo para la detecci√≥n de amenazas evasivas

Hoy en d√≠a, los atacantes usan t√©cnicas de evasi√≥n (cifrado, fragmentaci√≥n, tr√°fico lento).

Para contrarrestarlo:

- Los IPS modernos integran **Machine Learning y Deep Learning**.
- Crean perfiles de tr√°fico normal y detectan patrones an√≥malos incluso en **ataques zero-day**.

üìå Ejemplo:

- Un IPS con **IA** puede identificar que un flujo de tr√°fico HTTPS en realidad es un malware que se comunica con un **C\&C (Command and Control)**, aunque no coincida con ninguna firma conocida.

### ‚ùì Preguntas frecuentes sobre IPS

#### üîπ ¬øCu√°l es la diferencia entre IDS e IPS?

- **IDS**: detecta y alerta.
- **IPS**: detecta y bloquea.

#### üîπ ¬øUn IPS reemplaza al firewall?

No üö´. El firewall **controla accesos**, mientras que el IPS **detecta y detiene ataques m√°s avanzados** que pasan el firewall.

#### üîπ ¬øD√≥nde se implementa un IPS?

- Generalmente, en l√≠nea con el tr√°fico entre la red interna y externa.
- Tambi√©n puede estar integrado en **NGFW**.

#### üîπ ¬øEjemplos de IPS populares?

- **Snort** (con modo IPS).
- **Suricata**.
- **Cisco FirePOWER**.
- **Palo Alto NGFW con IPS integrado**.

### ‚úÖ Resumen

- Un **IPS** es un sistema que **detecta y bloquea intrusiones en tiempo real**.
- Funciona analizando tr√°fico con m√©todos de firmas, anomal√≠as y comportamiento.
- Existen varios tipos: **NIPS, HIPS, WIPS, NBA**.
- Sus beneficios incluyen **prevenci√≥n proactiva, cumplimiento normativo y visibilidad de red**.
- Los IPS modernos integran **IA/Deep Learning** para detectar ataques evasivos.

---

[üîº](#√≠ndice)

---

## **386. Prevenci√≥n de intrusiones - SY0-601 CompTIA Security+**

### ¬øQu√© es la prevenci√≥n de intrusiones (IPS)?

Un **IPS (Intrusion Prevention System)** es una tecnolog√≠a que **inspecciona tr√°fico y actividad en tiempo real** para **detectar** comportamientos maliciosos y **actuar autom√°ticamente** para **bloquear o mitigar** el ataque (por ejemplo: borrar paquetes, resetear conexiones, bloquear IPs, aislar hosts).
Es la evoluci√≥n activa del IDS (Intrusion Detection System), que solo **detecta y notifica**.

### Conceptos clave y diferencias (puntos SY0-601)

- **IDS vs IPS**

  - _IDS_: pasivo, detecta y alerta.
  - _IPS_: en l√≠nea (inline), detecta y **bloquea**.

- **Modo inline**: IPS est√° en la ruta del tr√°fico; puede detener paquetes.
- **Fail-open / Fail-closed**: comportamiento si el IPS falla ‚Äî _fail-open_ permite el tr√°fico (riesgo), _fail-closed_ lo bloquea (disponibilidad).
- **T√©cnicas de detecci√≥n**: _signature-based_, _anomaly-based_, _stateful protocol analysis_ (estos 3 aparecen en el examen).
- **Tipos**: NIPS (Network), HIPS (Host), WIPS (Wireless), NGIPS (Next-Gen IPS).

### ¬øC√≥mo funciona un IPS? (flujo b√°sico)

1. _Captura_ de paquetes/actividades (sensor inline o agente en host).
2. _Normalizaci√≥n/reensamblaje_ (reconstruye streams para evitar evasi√≥n por fragmentaci√≥n).
3. _Comparaci√≥n_ con firmas y/o an√°lisis de comportamiento.
4. _Decisi√≥n_ (malicioso / benigno / sospechoso).
5. _Acci√≥n preventiva_ (drop, reject, reset TCP, bloquear IP, rate-limit, aislar host).
6. _Registro y notificaci√≥n_ al SIEM/SOC.

### Tipos de detecci√≥n explicado (clave para el examen)

1. **Signature-based (firmas)**

   - Busca patrones exactos (payloads, secuencias). Eficaz contra ataques conocidos.
   - _Contras_: no detecta zero-day ni variantes sin firma.

2. **Anomaly-based (basado en anomal√≠as)**

   - Crea un perfil del comportamiento ‚Äúnormal‚Äù y marca desviaciones (p. ej. aumento de tr√°fico, actividad nocturna).
   - _Contras_: m√°s falsos positivos; necesita aprendizaje/baselining.

3. **Stateful protocol analysis**

   - Entiende el estado y la l√≥gica de protocolos (ej. reensamblar TCP, analizar FTP/HTTP) para detectar usos no v√°lidos del protocolo.

4. **Reputaci√≥n / Threat Intel**

   - Listas de IP/URLs maliciosas usadas para bloquear comunicaciones conocidas maliciosas.

### D√≥nde y c√≥mo se despliega (localizaci√≥n y consideraciones)

- **Per√≠metro** (entre Internet y DMZ): frena ataques externos.
- **DMZ** (entre Internet y red interna): protege servidores p√∫blicos.
- **Segmentos internos**: detecta lateral movement.
- **En los endpoints** (HIPS): protecci√≥n a nivel host (servidores cr√≠ticos).
- **Cloud / virtual**: NGIPS en nube o virtual appliances para ambientes cloud.

Consideraciones: **latencia**, **throughput**, _fail-open/closed_, integraci√≥n con SIEM y actualizaci√≥n de firmas.

### Ejemplos de respuesta que un IPS puede ejecutar

- `drop` paquetes del atacante.
- `reset` la conexi√≥n TCP (TCP RST).
- `block` IP en firewall durante X minutos.
- `rate-limit` tr√°fico sospechoso.
- `aislar` host (quarantine en la red).
- `enviar alerta` al SOC y registrar evidencias.

### Evasiones comunes y contramedidas (pregunta frecuente en el examen)

- **Fragmentaci√≥n de paquetes** ‚Üí IPS debe reensamblar (reassembly).
- **Ofuscaci√≥n/encoding** del payload ‚Üí usar DPI y normalizaci√≥n.
- **Cifrado (TLS/SSL)** ‚Üí necesidad de SSL/TLS inspection (terminaci√≥n o passthrough con inspecci√≥n).
- **Tr√°fico lento (low-and-slow)** ‚Üí anomaly detection con ventanas temporales.
- **Polimorfismo / packing** ‚Üí an√°lisis din√°mico (sandbox) y detecci√≥n por comportamiento/ML.
- **IP spoofing** ‚Üí filtros de origen, anti-spoofing, validaci√≥n de sesiones.

### NGIPS ‚Äî qu√© trae de extra

- Integraci√≥n con _threat intelligence feeds_.
- _Application awareness_ (identifica aplicaciones independientemente de puerto).
- Sandboxing para an√°lisis de archivos sospechosos.
- Correlaci√≥n con otros dispositivos de seguridad (SIEM, EDR).
- Mejor rendimiento y escalabilidad.

### Ejemplo pr√°ctico: regla Snort (detecci√≥n) y modo IPS (prevenci√≥n)

**Regla Snort (alerta) que detecta intento muy b√°sico de SQL Injection:**

```text
alert tcp any any -> $HOME_NET 80 (msg:"SQL Injection attempt - basic OR1"; content:"' OR '1'='1"; nocase; sid:1000001; rev:1;)
```

- `alert` ‚Üí genera alerta.
- Para **IPS** (modo inline), la acci√≥n podr√≠a ser `drop` o en Suricata:

```text
drop http any any -> $HOME_NET 80 (msg:"SQL Injection attempt - basic OR1"; http_uri; content:"' OR '1'='1"; nocase; sid:1000001; rev:1;)
```

> **Nota**: en producci√≥n no uses √∫nicamente cadenas simples; se requieren firmas robustas y tuning.

**C√≥mo aplicar**: Snort/Suricata en modo inline (AF_PACKET, NFQUEUE o como appliance), regla activa, alertas hacia SIEM.

### Ejemplo de caso real (flujo)

1. IPS detecta patr√≥n de SQLi en tr√°fico HTTP‚Üí genera alerta y _drop_.
2. IPS bloquea IP origen por 1 hora.
3. IPS env√≠a evento al SIEM y crea ticket en la consola SOC.
4. SOC revisa logs, confirma ataque y lanza playbook: escanear servidores web, parchear, buscar compromisos.

### Falsos positivos y tuning (muy importante para SY0-601)

- **Falsos positivos**: APS generan interrupciones de negocio si bloquean tr√°fico leg√≠timo.
- **T√©cnicas de tuning**: whitelist, supresi√≥n de SID (Snort), reglas por contexto, modo aprendizaje, despliegue en modo _alert_ durante fases piloto.
- **Baselining**: aprender tr√°fico normal antes de poner pol√≠ticas agresivas.

### Integraci√≥n con otras tecnolog√≠as

- **Firewalls (NGFW)**: bloqueo por IP, certificados, URL.
- **SIEM**: correlaci√≥n, alertas, retenci√≥n.
- **EDR / HIPS**: respuestas a nivel host.
- **Sandbox**: an√°lisis de archivos desconocidos.
- **Threat Intelligence**: actualizar listas y reglas autom√°ticamente.

### Caracter√≠sticas cr√≠ticas a evaluar en un IPS

- Capacidad de _inspecci√≥n profunda de paquetes (DPI)_.
- Soporte para _SSL/TLS inspection_.
- Actualizaciones de firmas y feeds de _Threat Intelligence_.
- Escalabilidad (throughput, concurrencia).
- Modo inline y pol√≠ticas fail-open/closed configurables.
- Integraci√≥n con SIEM y orquestaci√≥n (SOAR).
- Capacidades de _stateful_ y _protocol analysis_.

### Buenas pr√°cticas de despliegue

1. **Modo auditor√≠a/alerta** inicialmente.
2. **Despliegue gradual**: per√≠metro ‚Üí DMZ ‚Üí segmentos internos.
3. **Tuning y whitelist** para reducir falsos positivos.
4. **Pol√≠ticas diferenciadas** por criticidad de activos.
5. **Testing de performance** (latencia e impacto).
6. **Actualizar firmas/feeds** y monitorizar KPIs (MTTD/MTTR).
7. **Plan de respuesta** (playbooks) para incidentes detectados por IPS.

### Preparaci√≥n para el examen SY0-601 ‚Äî puntos a memorizar

- Definici√≥n IPS vs IDS.
- Tipos: NIPS, HIPS, WIPS, NGIPS.
- M√©todos de detecci√≥n: _signature_, _anomaly_, _stateful protocol analysis_.
- Evasiones comunes: fragmentaci√≥n, cifrado, ofuscaci√≥n.
- Respuestas que puede ejecutar un IPS: drop, reset, block IP, quarantine.
- Consideraciones de despliegue: inline, fail-open/fail-closed, latencia.
- Integraci√≥n con SIEM/EDR/sandbox y threat intelligence.

### Preguntas pr√°cticas (estilo examen) ‚Äî con respuestas

1. **¬øCu√°l es la diferencia principal entre IDS y IPS?**

   - _Respuesta:_ IDS detecta y alerta; IPS detecta y bloquea.

2. **Un IPS est√° en modo inline y falla. ¬øqu√© comportamiento podr√≠a causar un problema de disponibilidad?**

   - _Respuesta:_ Si est√° configurado _fail-closed_, el tr√°fico ser√° bloqueado y podr√≠a provocar indisponibilidad.

3. **¬øQu√© t√©cnica de evasi√≥n podr√≠a evitar la detecci√≥n por firmas y c√≥mo la mitigas?**

   - _Respuesta:_ Fragmentaci√≥n de paquetes ‚Äî mitigar con reassembly (reensamblado) y DPI.

4. **Selecciona la mejor descripci√≥n de NGIPS:**

   - _Respuesta:_ Un NGIPS incluye DPI, control de aplicaciones y feeds de threat intelligence adem√°s de IPS cl√°sico.

---

[üîº](#√≠ndice)

---

| **Inicio**         | **atr√°s 14**          | **Siguiente 16**                     |
| ------------------ | --------------------- | ------------------------------------ |
| [üè†](../README.md) | [‚è™](./12_14_NIDS.md) | [‚è©](./12_16_Host_based_Firewall.md) |
