| **Inicio**         | **atrás 14**          | **Siguiente 16**                     |
| ------------------ | --------------------- | ------------------------------------ |
| [🏠](../README.md) | [⏪](./12_14_NIDS.md) | [⏩](./12_16_Host_based_Firewall.md) |

---

## **Índice**

| Temario                                                                                                                 |
| ----------------------------------------------------------------------------------------------------------------------- |
| [385. ¿Qué es un sistema de prevención de intrusiones?](#385-qué-es-un-sistema-de-prevención-de-intrusiones)            |
| [386. Prevención de intrusiones - SY0-601 CompTIA Security+](#386-prevención-de-intrusiones---sy0-601-comptia-security) |

# **NIPS**

## **385. ¿Qué es un sistema de prevención de intrusiones?**

![NIPS](/img/12_Secure_vs_Unsecure_Protocols/NIPS.jpg "NIPS")

Un **IPS (Intrusion Prevention System)** es una solución de seguridad que **monitorea el tráfico de red en tiempo real, detecta actividades maliciosas y las bloquea automáticamente** antes de que causen daño.

👉 A diferencia de un **IDS (Intrusion Detection System)**, que solo detecta y alerta, el **IPS actúa de forma activa** para detener el ataque.

📌 Ejemplo:

- Si un atacante lanza un **ataque de fuerza bruta SSH**, el IPS no solo genera una alerta, sino que **bloquea la IP maliciosa** inmediatamente.

### ⚙️ ¿Cómo funcionan los sistemas de prevención de intrusiones?

El funcionamiento de un IPS se puede dividir en pasos:

1. **Monitoreo del tráfico**

   - El IPS se ubica en línea entre el firewall y la red interna, inspeccionando cada paquete.

2. **Análisis del tráfico**

   - Usa métodos de detección (firmas, anomalías, comportamiento, heurística).

3. **Acción preventiva**

   - Si detecta una amenaza, puede:

     - Bloquear el paquete sospechoso.
     - Terminar la conexión.
     - Aislar al host afectado.

4. **Generación de reportes y logs**

   - Registra detalles del ataque para auditoría y análisis forense.

📌 Ejemplo práctico:

- Un usuario intenta inyectar un comando SQL en una aplicación web (`' OR '1'='1`).
- El IPS detecta el patrón de **SQL Injection** y **bloquea la petición** antes de que llegue al servidor.

### 🧩 Tipos de sistemas de prevención de intrusiones

Existen varios tipos según su enfoque:

1. **NIPS (Network-based IPS)** 🌐

   - Analiza el tráfico de red completo.
   - Ejemplo: detectar un **ataque DDoS** contra un servidor web.

2. **HIPS (Host-based IPS)** 💻

   - Se instala en un host individual (servidor, PC).
   - Ejemplo: bloquear un proceso sospechoso en Windows que intenta modificar el registro.

3. **WIPS (Wireless IPS)** 📶

   - Protege redes Wi-Fi contra ataques como **rogue access points** o sniffing.
   - Ejemplo: bloquear un punto de acceso no autorizado en una oficina.

4. **NBA (Network Behavior Analysis)** 📊

   - Analiza el comportamiento del tráfico y detecta anomalías.
   - Ejemplo: detectar que una máquina infectada está enviando tráfico masivo hacia el exterior (botnet).

### 🎯 Beneficios de los sistemas de prevención de intrusiones

1. **Bloqueo en tiempo real** de ataques antes de que lleguen al sistema.
2. **Protección contra amenazas conocidas y desconocidas** (dependiendo del motor de detección).
3. **Reducción de riesgos internos** (ataques de empleados malintencionados).
4. **Cumplimiento normativo** (PCI DSS, HIPAA, ISO 27001 requieren controles de detección/preventivos).
5. **Visibilidad del tráfico de red** → ayuda en auditorías y forense digital.

📌 Ejemplo:

- Una empresa de salud con IPS puede evitar que datos de pacientes sean exfiltrados mediante un malware.

### 🔑 Características críticas de un IPS

- **Inspección profunda de paquetes (DPI)**: analiza hasta la capa de aplicación (HTTP, DNS, SMTP).
- **Múltiples técnicas de detección**: firmas, anomalías, reputación de IPs, machine learning.
- **Capacidad de respuesta automática**: bloquear, aislar, desconectar.
- **Actualizaciones en tiempo real** de reglas y firmas.
- **Integración con SIEM y firewalls de nueva generación (NGFW)**.
- **Escalabilidad** para manejar alto volumen de tráfico sin generar latencia.

### 🤖 Aprendizaje profundo para la detección de amenazas evasivas

Hoy en día, los atacantes usan técnicas de evasión (cifrado, fragmentación, tráfico lento).

Para contrarrestarlo:

- Los IPS modernos integran **Machine Learning y Deep Learning**.
- Crean perfiles de tráfico normal y detectan patrones anómalos incluso en **ataques zero-day**.

📌 Ejemplo:

- Un IPS con **IA** puede identificar que un flujo de tráfico HTTPS en realidad es un malware que se comunica con un **C\&C (Command and Control)**, aunque no coincida con ninguna firma conocida.

### ❓ Preguntas frecuentes sobre IPS

#### 🔹 ¿Cuál es la diferencia entre IDS e IPS?

- **IDS**: detecta y alerta.
- **IPS**: detecta y bloquea.

#### 🔹 ¿Un IPS reemplaza al firewall?

No 🚫. El firewall **controla accesos**, mientras que el IPS **detecta y detiene ataques más avanzados** que pasan el firewall.

#### 🔹 ¿Dónde se implementa un IPS?

- Generalmente, en línea con el tráfico entre la red interna y externa.
- También puede estar integrado en **NGFW**.

#### 🔹 ¿Ejemplos de IPS populares?

- **Snort** (con modo IPS).
- **Suricata**.
- **Cisco FirePOWER**.
- **Palo Alto NGFW con IPS integrado**.

### ✅ Resumen

- Un **IPS** es un sistema que **detecta y bloquea intrusiones en tiempo real**.
- Funciona analizando tráfico con métodos de firmas, anomalías y comportamiento.
- Existen varios tipos: **NIPS, HIPS, WIPS, NBA**.
- Sus beneficios incluyen **prevención proactiva, cumplimiento normativo y visibilidad de red**.
- Los IPS modernos integran **IA/Deep Learning** para detectar ataques evasivos.

---

[🔼](#índice)

---

## **386. Prevención de intrusiones - SY0-601 CompTIA Security+**

### ¿Qué es la prevención de intrusiones (IPS)?

Un **IPS (Intrusion Prevention System)** es una tecnología que **inspecciona tráfico y actividad en tiempo real** para **detectar** comportamientos maliciosos y **actuar automáticamente** para **bloquear o mitigar** el ataque (por ejemplo: borrar paquetes, resetear conexiones, bloquear IPs, aislar hosts).
Es la evolución activa del IDS (Intrusion Detection System), que solo **detecta y notifica**.

### Conceptos clave y diferencias (puntos SY0-601)

- **IDS vs IPS**

  - _IDS_: pasivo, detecta y alerta.
  - _IPS_: en línea (inline), detecta y **bloquea**.

- **Modo inline**: IPS está en la ruta del tráfico; puede detener paquetes.
- **Fail-open / Fail-closed**: comportamiento si el IPS falla — _fail-open_ permite el tráfico (riesgo), _fail-closed_ lo bloquea (disponibilidad).
- **Técnicas de detección**: _signature-based_, _anomaly-based_, _stateful protocol analysis_ (estos 3 aparecen en el examen).
- **Tipos**: NIPS (Network), HIPS (Host), WIPS (Wireless), NGIPS (Next-Gen IPS).

### ¿Cómo funciona un IPS? (flujo básico)

1. _Captura_ de paquetes/actividades (sensor inline o agente en host).
2. _Normalización/reensamblaje_ (reconstruye streams para evitar evasión por fragmentación).
3. _Comparación_ con firmas y/o análisis de comportamiento.
4. _Decisión_ (malicioso / benigno / sospechoso).
5. _Acción preventiva_ (drop, reject, reset TCP, bloquear IP, rate-limit, aislar host).
6. _Registro y notificación_ al SIEM/SOC.

### Tipos de detección explicado (clave para el examen)

1. **Signature-based (firmas)**

   - Busca patrones exactos (payloads, secuencias). Eficaz contra ataques conocidos.
   - _Contras_: no detecta zero-day ni variantes sin firma.

2. **Anomaly-based (basado en anomalías)**

   - Crea un perfil del comportamiento “normal” y marca desviaciones (p. ej. aumento de tráfico, actividad nocturna).
   - _Contras_: más falsos positivos; necesita aprendizaje/baselining.

3. **Stateful protocol analysis**

   - Entiende el estado y la lógica de protocolos (ej. reensamblar TCP, analizar FTP/HTTP) para detectar usos no válidos del protocolo.

4. **Reputación / Threat Intel**

   - Listas de IP/URLs maliciosas usadas para bloquear comunicaciones conocidas maliciosas.

### Dónde y cómo se despliega (localización y consideraciones)

- **Perímetro** (entre Internet y DMZ): frena ataques externos.
- **DMZ** (entre Internet y red interna): protege servidores públicos.
- **Segmentos internos**: detecta lateral movement.
- **En los endpoints** (HIPS): protección a nivel host (servidores críticos).
- **Cloud / virtual**: NGIPS en nube o virtual appliances para ambientes cloud.

Consideraciones: **latencia**, **throughput**, _fail-open/closed_, integración con SIEM y actualización de firmas.

### Ejemplos de respuesta que un IPS puede ejecutar

- `drop` paquetes del atacante.
- `reset` la conexión TCP (TCP RST).
- `block` IP en firewall durante X minutos.
- `rate-limit` tráfico sospechoso.
- `aislar` host (quarantine en la red).
- `enviar alerta` al SOC y registrar evidencias.

### Evasiones comunes y contramedidas (pregunta frecuente en el examen)

- **Fragmentación de paquetes** → IPS debe reensamblar (reassembly).
- **Ofuscación/encoding** del payload → usar DPI y normalización.
- **Cifrado (TLS/SSL)** → necesidad de SSL/TLS inspection (terminación o passthrough con inspección).
- **Tráfico lento (low-and-slow)** → anomaly detection con ventanas temporales.
- **Polimorfismo / packing** → análisis dinámico (sandbox) y detección por comportamiento/ML.
- **IP spoofing** → filtros de origen, anti-spoofing, validación de sesiones.

### NGIPS — qué trae de extra

- Integración con _threat intelligence feeds_.
- _Application awareness_ (identifica aplicaciones independientemente de puerto).
- Sandboxing para análisis de archivos sospechosos.
- Correlación con otros dispositivos de seguridad (SIEM, EDR).
- Mejor rendimiento y escalabilidad.

### Ejemplo práctico: regla Snort (detección) y modo IPS (prevención)

**Regla Snort (alerta) que detecta intento muy básico de SQL Injection:**

```text
alert tcp any any -> $HOME_NET 80 (msg:"SQL Injection attempt - basic OR1"; content:"' OR '1'='1"; nocase; sid:1000001; rev:1;)
```

- `alert` → genera alerta.
- Para **IPS** (modo inline), la acción podría ser `drop` o en Suricata:

```text
drop http any any -> $HOME_NET 80 (msg:"SQL Injection attempt - basic OR1"; http_uri; content:"' OR '1'='1"; nocase; sid:1000001; rev:1;)
```

> **Nota**: en producción no uses únicamente cadenas simples; se requieren firmas robustas y tuning.

**Cómo aplicar**: Snort/Suricata en modo inline (AF_PACKET, NFQUEUE o como appliance), regla activa, alertas hacia SIEM.

### Ejemplo de caso real (flujo)

1. IPS detecta patrón de SQLi en tráfico HTTP→ genera alerta y _drop_.
2. IPS bloquea IP origen por 1 hora.
3. IPS envía evento al SIEM y crea ticket en la consola SOC.
4. SOC revisa logs, confirma ataque y lanza playbook: escanear servidores web, parchear, buscar compromisos.

### Falsos positivos y tuning (muy importante para SY0-601)

- **Falsos positivos**: APS generan interrupciones de negocio si bloquean tráfico legítimo.
- **Técnicas de tuning**: whitelist, supresión de SID (Snort), reglas por contexto, modo aprendizaje, despliegue en modo _alert_ durante fases piloto.
- **Baselining**: aprender tráfico normal antes de poner políticas agresivas.

### Integración con otras tecnologías

- **Firewalls (NGFW)**: bloqueo por IP, certificados, URL.
- **SIEM**: correlación, alertas, retención.
- **EDR / HIPS**: respuestas a nivel host.
- **Sandbox**: análisis de archivos desconocidos.
- **Threat Intelligence**: actualizar listas y reglas automáticamente.

### Características críticas a evaluar en un IPS

- Capacidad de _inspección profunda de paquetes (DPI)_.
- Soporte para _SSL/TLS inspection_.
- Actualizaciones de firmas y feeds de _Threat Intelligence_.
- Escalabilidad (throughput, concurrencia).
- Modo inline y políticas fail-open/closed configurables.
- Integración con SIEM y orquestación (SOAR).
- Capacidades de _stateful_ y _protocol analysis_.

### Buenas prácticas de despliegue

1. **Modo auditoría/alerta** inicialmente.
2. **Despliegue gradual**: perímetro → DMZ → segmentos internos.
3. **Tuning y whitelist** para reducir falsos positivos.
4. **Políticas diferenciadas** por criticidad de activos.
5. **Testing de performance** (latencia e impacto).
6. **Actualizar firmas/feeds** y monitorizar KPIs (MTTD/MTTR).
7. **Plan de respuesta** (playbooks) para incidentes detectados por IPS.

### Preparación para el examen SY0-601 — puntos a memorizar

- Definición IPS vs IDS.
- Tipos: NIPS, HIPS, WIPS, NGIPS.
- Métodos de detección: _signature_, _anomaly_, _stateful protocol analysis_.
- Evasiones comunes: fragmentación, cifrado, ofuscación.
- Respuestas que puede ejecutar un IPS: drop, reset, block IP, quarantine.
- Consideraciones de despliegue: inline, fail-open/fail-closed, latencia.
- Integración con SIEM/EDR/sandbox y threat intelligence.

### Preguntas prácticas (estilo examen) — con respuestas

1. **¿Cuál es la diferencia principal entre IDS y IPS?**

   - _Respuesta:_ IDS detecta y alerta; IPS detecta y bloquea.

2. **Un IPS está en modo inline y falla. ¿qué comportamiento podría causar un problema de disponibilidad?**

   - _Respuesta:_ Si está configurado _fail-closed_, el tráfico será bloqueado y podría provocar indisponibilidad.

3. **¿Qué técnica de evasión podría evitar la detección por firmas y cómo la mitigas?**

   - _Respuesta:_ Fragmentación de paquetes — mitigar con reassembly (reensamblado) y DPI.

4. **Selecciona la mejor descripción de NGIPS:**

   - _Respuesta:_ Un NGIPS incluye DPI, control de aplicaciones y feeds de threat intelligence además de IPS clásico.

---

[🔼](#índice)

---

| **Inicio**         | **atrás 14**          | **Siguiente 16**                     |
| ------------------ | --------------------- | ------------------------------------ |
| [🏠](../README.md) | [⏪](./12_14_NIDS.md) | [⏩](./12_16_Host_based_Firewall.md) |
