| **Inicio**         | **atr√°s 8**               | **Siguiente 10**     |
| ------------------ | ------------------------- | -------------------- |
| [üè†](../README.md) | [‚è™](./12_8_Antivirus.md) | [‚è©](./12_10_EDR.md) |

---

## **√çndice**

| Temario                                                                                                            |
| ------------------------------------------------------------------------------------------------------------------ |
| [373. Definici√≥n de antimalware](#373-definici√≥n-de-antimalware)                                                   |
| [374. ¬øQu√© es Antimalware?](#374-qu√©-es-antimalware)                                                               |
| [375. ¬øC√≥mo funciona el software antivirus y antimalware?](#375-c√≥mo-funciona-el-software-antivirus-y-antimalware) |

# **Anti-malware**

## **373. Definici√≥n de antimalware**

![Anti-malware](/img/12_Secure_vs_Unsecure_Protocols/Anti-malware.png "Anti-malware")

### ü¶† 1. Definici√≥n de antimalware

El **software antimalware** es un programa de seguridad inform√°tica dise√±ado para **detectar, bloquear y eliminar malware** en todas sus formas:

- **Virus tradicionales**
- **Troyanos** (ocultan c√≥digo malicioso en programas leg√≠timos)
- **Ransomware** (cifra archivos y pide rescate)
- **Spyware** (roba informaci√≥n personal)
- **Adware** (muestra publicidad invasiva)
- **Rootkits** (ocultan procesos maliciosos a nivel del sistema operativo)

üëâ Mientras que el **antivirus** comenz√≥ enfocado en virus, el **antimalware** es m√°s amplio y cubre amenazas modernas y avanzadas.
De hecho, hoy la mayor√≠a de los antivirus comerciales son realmente **suites antimalware**.

### üîê 2. ¬øPor qu√© instalar software antimalware?

- Los ciberataques son cada vez m√°s sofisticados (ransomware, phishing, malware polim√≥rfico).
- Un solo archivo infectado puede robar contrase√±as, bloquear tu PC o usarla en ataques DDoS.
- Las actualizaciones de Windows, macOS o Linux **no son suficientes**; necesitas defensa especializada.
- En empresas, protege la confidencialidad y evita sanciones legales (ej.: fuga de datos personales bajo GDPR o Ley de Protecci√≥n de Datos).

üëâ Ejemplo: si recibes un adjunto de ‚Äúfactura.pdf‚Äù que en realidad es un malware, el antimalware lo detecta y bloquea antes de ejecutarse.

### üîé 3. Software antimalware: qu√© buscar en √©l

Al elegir un programa antimalware, deber√≠as fijarte en:

‚úÖ **Protecci√≥n en tiempo real** (no solo escaneos manuales).

‚úÖ **Actualizaciones autom√°ticas de firmas y motores**.

‚úÖ **Heur√≠stica y machine learning** para amenazas nuevas.

‚úÖ **Detecci√≥n de comportamiento** (ej. bloquear ransomware en ejecuci√≥n).

‚úÖ **Escaneo de correo y web** (contra phishing y descargas maliciosas).

‚úÖ **Cuarentena segura** para aislar amenazas.

‚úÖ **Compatibilidad multiplataforma** (Windows, Mac, Linux, Android, iOS).

‚úÖ **Bajo consumo de recursos** (que no ralentice el sistema).

üëâ Ejemplo: Bitdefender usa _machine learning_ para detectar ransomware aunque no tenga firma exacta.

### üñ•Ô∏è 4. Software antimalware independiente

Se instalan como **aplicaciones individuales**, normalmente junto a un antivirus o como segunda capa de seguridad.

- Ejemplos: **Malwarebytes**, **HitmanPro**, **Zemana Antimalware**.
- Son √∫tiles para **detecci√≥n y limpieza** cuando el antivirus principal falla o no detecta algo.

üëâ Ejemplo: tienes Windows Defender, pero usas **Malwarebytes Free** como refuerzo para an√°lisis bajo demanda.

### üì¶ 5. Paquetes de software de seguridad

Los fabricantes ofrecen **suites de seguridad completas** que incluyen:

- Antivirus + Antimalware
- Firewall
- Antiphishing / anti-spam
- Control parental
- VPN integrada
- Protecci√≥n de banca online

Ejemplos:

- **Kaspersky Internet Security**
- **ESET Internet Security**
- **Norton 360**

üëâ Estas suites son ideales para usuarios que quieren una protecci√≥n **todo en uno** sin instalar varios programas.

### ‚òÅÔ∏è 6. Software antimalware en la nube

- Funciona basado en **inteligencia centralizada en servidores remotos**.
- El an√°lisis pesado se hace en la nube ‚Üí el impacto en tu PC es menor.
- Beneficio: detecci√≥n r√°pida de amenazas emergentes a nivel global.

Ejemplos:

- **CrowdStrike Falcon**
- **Microsoft Defender for Endpoint**
- **Sophos Intercept X**

üëâ Ideal para empresas, porque permite monitorear **todos los dispositivos desde una consola centralizada**.

### üåü 7. Caracter√≠sticas clave del software antimalware

1. **Protecci√≥n multicapa** ‚Üí firmas, heur√≠stica, comportamiento y nube.
2. **Escaneo bajo demanda y en tiempo real**.
3. **Cuarentena y limpieza autom√°tica**.
4. **An√°lisis del tr√°fico web y correo electr√≥nico**.
5. **Protecci√≥n contra ransomware** con bloqueo de accesos no autorizados.
6. **Interfaz intuitiva y f√°cil administraci√≥n**.
7. **Soporte y actualizaciones continuas** (muy importante en empresas).

‚úÖ **En resumen**:

El **antimalware** es la evoluci√≥n del antivirus tradicional, preparado para enfrentar amenazas modernas como ransomware, spyware y malware polim√≥rfico. Puedes elegir entre soluciones **independientes** (ej. Malwarebytes) o **suites completas** (ej. Kaspersky, Norton), y en entornos empresariales la tendencia es usar **soluciones antimalware en la nube** que permitan administraci√≥n centralizada.

---

[üîº](#√≠ndice)

---

## **374. ¬øQu√© es Antimalware?**

**Antimalware** es software dise√±ado para **detectar, bloquear, aislar y eliminar** todo tipo de _malware_ ‚Äîno solo virus‚Äî: troyanos, ransomware, spyware, adware, rootkits, gusanos, cryptominers, etc.
Es la evoluci√≥n del ¬´antivirus¬ª cl√°sico: mientras el antivirus se enfocaba en virus concretos, el antimalware aborda la amplia y cambiante familia de amenazas modernas.

### ¬øEn qu√© se diferencia de un antivirus tradicional?

- **Antivirus** ‚Üí hist√≥ricamente orientado a detecci√≥n por firmas de virus.
- **Antimalware** ‚Üí incluye firmas **y** t√©cnicas avanzadas: heur√≠stica, detecci√≥n por comportamiento, sandboxing, aprendizaje autom√°tico (ML), EDR (Endpoint Detection & Response), y an√°lisis en la nube.
  En otras palabras, antimalware = antivirus + capas modernas de defensa.

### ¬øC√≥mo funciona? (mecanismos principales)

1. **Firma (signature-based detection)**

   - Base de datos de hashes/patrones de malware conocido. Muy efectiva para amenazas conocidas y r√°pida.

2. **Heur√≠stica / an√°lisis est√°tico**

   - Inspecciona el c√≥digo sin ejecutarlo buscando patrones sospechosos (por ejemplo, funciones de ofuscaci√≥n).

3. **Detecci√≥n por comportamiento (behavioral / runtime)**

   - Monitorea acciones en tiempo real (p. ej. creaci√≥n masiva de archivos, modificaci√≥n del MBR, conexiones hacia C2). Si detecta comportamiento malicioso, bloquea la ejecuci√≥n.

4. **Sandboxing / an√°lisis din√°mico**

   - Ejecuta muestras en un entorno aislado para observar su comportamiento y decidir si son maliciosas.

5. **Machine Learning / reputaci√≥n y nube**

   - Env√≠o de telemetr√≠a a la nube, comparaci√≥n contra modelos y reputaciones globales para identificar amenazas emergentes sin firma exacta.

6. **Reglas y IOC (Indicators of Compromise)**

   - YARA rules, listas de hashes, IPs/domains maliciosos, firmas personalizadas de la organizaci√≥n.

7. **Remediaci√≥n y recuperaci√≥n**

   - Cuarentena, eliminaci√≥n, restauraci√≥n (rollback), bloqueo de procesos y aislamiento de red.

### Tipos de soluciones (y cu√°ndo usar cada una)

- **Antimalware de escritorio / endpoint (on-access + on-demand)** ‚Äî para PCs y servidores.
- **NGAV (Next-Gen Antivirus)** ‚Äî a√±ade ML y detecci√≥n de comportamiento.
- **EDR (Endpoint Detection & Response)** ‚Äî telemetr√≠a, b√∫squeda de amenazas (hunt), respuesta remota y forense.
- **MDR (Managed Detection & Response)** ‚Äî EDR + servicio gestionado 24/7.
- **Gateway/Email/Web anti-malware** ‚Äî bloquea malware en tr√°nsito (email, web proxies).
- **Antimalware en la nube / cloud AV** ‚Äî an√°lisis pesado fuera del endpoint, buena escalabilidad para empresas.

### Caracter√≠sticas clave que debes buscar

- Protecci√≥n en **tiempo real** y escaneo programado.
- **Detecci√≥n por comportamiento** y bloqueo de ransomware.
- **Sandboxing** y an√°lisis din√°mico.
- **Integraci√≥n con SIEM / APIs** para automatizaci√≥n.
- Consola centralizada para **gesti√≥n y telemetr√≠a** (importante en empresas).
- **Rollback / File recovery** (para mitigar ransomware).
- Soporte multiplataforma (Windows, macOS, Linux, m√≥vil).
- **Bajo impacto en rendimiento** y actualizaciones autom√°ticas.

### Ejemplos pr√°cticos (comandos y reglas)

#### 1) Escanear con Windows Defender (PowerShell)

```powershell
# Actualizar definiciones
Update-MpSignature

# Escaneo r√°pido
Start-MpScan -ScanType QuickScan

# Escaneo completo
Start-MpScan -ScanType FullScan

# Mostrar estado
Get-MpComputerStatus
```

#### 2) Escanear con ClamAV (Linux)

```bash
# Actualizar firmas
sudo freshclam

# Escanear directorio
clamscan -r /home/usuario

# Escanear y mover infectados a cuarentena
clamscan -r --move=/ruta/quarantine /home/usuario
```

#### 3) Ejemplo simple de regla YARA (para detectar un binario con cadena sospechosa)

```yara
rule Ejemplo_Malicioso {
  meta:
    author = "Gustavo"
    description = "Detecta binarios con cadena maliciosa X"
  strings:
    $a = "malicious_string_example"
    $b = { E8 ?? ?? ?? ?? 5D }  // patr√≥n hexad√©cimal
  condition:
    $a or $b
}
```

- Las YARA rules son usadas por analistas y sandboxes para clasificar muestras.

### Escenario real ‚Äî ¬øc√≥mo responde el antimalware ante un ransomware?

1. Ransomware intenta cifrar archivos masivos.
2. Motor de comportamiento detecta muchas escrituras/rename en carpetas de usuario ‚Üí trigger de regla ‚Äúransomware-like‚Äù.
3. Antimalware bloquea el proceso, lo mueve a cuarentena y (si la soluci√≥n lo soporta) **restaura los archivos** desde snapshot o copia local.
4. Consola central recibe alerta y el equipo de seguridad a√≠sla el host en la red para evitar propagaci√≥n.

### Limitaciones y falsos positivos

- **0-day muy sofisticados** pueden evadir detecci√≥n inicialmente.
- **Falsos positivos**: software leg√≠timo puede parecer malicioso y ser bloqueado.
- **Necesidad de capas**: antimalware no reemplaza backups, parches ni controles de acceso.
- **Privacidad & permisos**: el software necesita acceso profundo al sistema (elige proveedores confiables).

### Productos representativos (ejemplos)

- **Microsoft Defender for Endpoint** ‚Äî integrado en Windows, con EDR y nube.
- **Malwarebytes** ‚Äî buena soluci√≥n de limpieza y refuerzo en endpoints.
- **CrowdStrike Falcon** ‚Äî NGAV + EDR en la nube, popular en empresas.
- **Sophos Intercept X** ‚Äî detecci√≥n basada en ML y anti-ransomware.
- **ESET / Kaspersky / Bitdefender** ‚Äî suites con buen equilibrio rendimiento/funcionalidad.

### Buenas pr√°cticas al usar antimalware

- Mant√©n las **firmas y el motor actualizados** autom√°ticamente.
- Implementa **copias de seguridad** offline/immutables (protecci√≥n contra ransomware).
- Usa **principio de menor privilegio**: usuarios sin admin reducen impacto.
- Complementa con **patch management**, firewall, filtrado web y formaci√≥n en phishing.
- Monitoriza alertas y define **playbooks de respuesta** (aislar, investigar, remediar, restaurar).
- Realiza pruebas peri√≥dicas (phishing simulations, incident drills).

### Resumen r√°pido (cheat-sheet)

- **Qu√© es**: software que protege contra malware moderno (m√°s amplio que antivirus).
- **C√≥mo lo hace**: firmas, heur√≠stica, comportamiento, sandbox, ML y nube.
- **Qu√© buscar**: EDR, anti-ransomware, sandbox, consola central, integraci√≥n SIEM.
- **Ejemplo de uso**: defender contra ransomware, limpiar infecciones, bloquear phishing por web/email.
- **Complementa con**: backups, parches, firewall, formaci√≥n y pol√≠ticas de acceso.

---

[üîº](#√≠ndice)

---

## **375. ¬øC√≥mo funciona el software antivirus y antimalware?**

### 1) Definici√≥n breve

**Antivirus / antimalware** = software que detecta, bloquea, a√≠sla y remedia _malware_ (virus, troyanos, ransomware, spyware, rootkits, cryptominers, etc.).

Hoy d√≠a las soluciones combinan: firmas, heur√≠stica, an√°lisis de comportamiento, sandboxing, machine-learning y telemetr√≠a en la nube (NGAV / EDR).

### 2) Arquitectura y componentes comunes

- **Agente en el endpoint**: servicio que monitoriza proceso/IO/red y aplica pol√≠ticas.
- **Motor de detecci√≥n**: compara firmas/IOCs y ejecuta an√°lisis est√°tico/din√°mico.
- **Base de firmas**: repositorio local de hashes/patrones.
- **M√≥dulo heur√≠stico**: analiza c√≥digo sin ejecutarlo.
- **Monitor de comportamiento**: regla/engine que observa acciones en tiempo real.
- **Sandbox / emulador**: ejecuta muestras en entorno aislado para observar comportamiento.
- **Cuarentena**: √°rea segura donde aislar archivos sospechosos.
- **Consola / nube de gesti√≥n**: para actualizaciones, alertas, telemetr√≠a y respuesta (EDR).
- **M√≥dulo de remediaci√≥n**: eliminaci√≥n, restauraci√≥n, rollback o aislamiento de red.

### 3) Flujo t√≠pico ‚Äî desde llegada del archivo hasta remediaci√≥n

1. **Detecci√≥n inicial**: archivo/HTTP/adjunto llega al endpoint.
2. **Escaneo en tiempo real**: motor hace checks r√°pidos (hashs, YARA, reputaci√≥n).
3. **Decisi√≥n r√°pida**:

   - Si firma conocida ‚Üí marcar/quarantena ‚Üí alertar.
   - Si sospechoso ‚Üí enviar a sandbox o activar reglas de comportamiento.

4. **An√°lisis din√°mico** (si procede): se ejecuta en sandbox; se observan llamadas al sistema, creaci√≥n de ficheros, conexiones a C2.
5. **Veredicto**: malicioso / benigno / inconcluso.
6. **Remediaci√≥n**: cuarentena, kill process, rollback de ficheros, aislamiento de host, env√≠o de eventos a SIEM.
7. **Actualizaci√≥n**: nueva firma/IOC se distribuye a todos los endpoints si es necesario.

### 4) M√©todos de detecci√≥n (detallado)

#### a) Detecci√≥n por firmas (signature-based)

- Comparaci√≥n de **hashes** (MD5/SHA256) o **patrones binarios** con base de datos.
- Muy eficaz contra amenazas conocidas.

  **Ejemplo (conceptual)**: si `sha256(file) in DB_signatures` ‚Üí marcar como malicioso.

#### b) Heur√≠stica / an√°lisis est√°tico

- Analiza estructura del archivo (cabeceras PE, imports, cadenas, secciones, entrop√≠a).
- Se√±ala comportamientos sospechosos sin ejecutar el binario.

  **Ejemplo**: un ejecutable con alta entrop√≠a + imports a funciones de cifrado + sin firma ‚Üí marcado como sospechoso.

#### c) Detecci√≥n por comportamiento (runtime)

- Observa acciones en tiempo real: creaci√≥n masiva/renombrado de ficheros, modificaci√≥n del MBR, inyecci√≥n en procesos, conexiones a IPs sospechosas.
- √ötil para detectar _ransomware_ o _fileless malware_.
  **Pseudoc√≥digo sencillo**:

```text
if proceso abre > X ficheros por segundo AND
   procesa extensiones .docx,.xlsx,.pdf y las sobrescribe THEN
   bloquear proceso; snapshot/rollback; alertar
```

#### d) Sandboxing / an√°lisis din√°mico

- Ejecuta la muestra en VM o emulador, registra API calls, red, creaci√≥n de procesos, registros de registro (Windows Registry), etc.
- Permite ver comportamiento oculto (descargas, persistencia, C2).

#### e) Machine Learning / reputaci√≥n / nube

- Modelos que usan features (n-grams, imports, llamadas API, sequences) para predecir malicia.
- Reputaci√≥n: compare metadatos con la nube (si millones de endpoints la han reportado maliciosa).

#### f) Reglas YARA / IOCs

- Reglas que detectan patrones complejos (cadenas, secuencias hex).

  **Ejemplo YARA** (b√°sico):

```yara
rule EjemploMalware {
  strings:
    $s1 = "malicious_string_example"
    $s2 = { E8 ?? ?? ?? ?? 5D }
  condition:
    $s1 or $s2
}
```

### 5) Ejemplos reales de uso / comandos √∫tiles

#### Windows Defender (PowerShell)

```powershell
# Actualizar firmas
Update-MpSignature

# Escaneo r√°pido
Start-MpScan -ScanType QuickScan

# Estado
Get-MpComputerStatus
```

#### ClamAV (Linux)

```bash
sudo freshclam
clamscan -r /home/usuario
clamscan -r --move=/ruta/quarantine /home/usuario
```

#### YARA (ejecutar rule)

```bash
yara regla_yara.yara muestra.bin
```

### 6) Detecci√≥n de ransomware ‚Äî ejemplo pr√°ctico (algoritmo de comportamiento)

- Se√±ales t√≠picas:

  - apertura de archivos en carpeta de usuario con flags write,
  - patr√≥n de renombrado (a√±ade extensi√≥n .lock, .crypted),
  - gran n√∫mero de operaciones I/O en poco tiempo,
  - creaci√≥n de procesos de ofuscaci√≥n o batch.

- Acci√≥n del antimalware: bloquear proceso, snapshot FS, restaurar ficheros desde shadow copies o backup.

### 7) EDR / NGAV vs antivirus tradicional

- **Antivirus cl√°sico**: firmas + heur√≠stica.
- **NGAV / EDR**: telemetr√≠a continua, b√∫squeda (hunt), respuesta remota (isolate host, kill process), preservaci√≥n de artefactos para forense.
- En entornos empresariales se prefiere EDR porque permite investigar y responder.

### 8) Evitaci√≥n y contra-t√©cnicas (y c√≥mo las mitigan)

- **Packing / obfuscation** ‚Üí contra: unpacking en sandbox y an√°lisis din√°mico.
- **Polimorfismo** ‚Üí contra: heur√≠stica y ML (no dependen de una sola firma).
- **Fileless malware** (en memoria) ‚Üí contra: monitoreo de comportamiento, API hooking, EDR.
- **Living-off-the-land (LOLbins)** ‚Üí contra: whitelisting, monitorizaci√≥n de comandos (PowerShell, WMI), detecci√≥n de anomal√≠as.

### 9) Telemetr√≠a, actualizaciones y cloud lookups

- Cuando un endpoint no tiene firma local, puede consultar la nube para reputaci√≥n (hash, certificado, URL).
- Las actualizaciones suelen ser diferenciales (delta) para reducir ancho de banda.
- Muchos vendors env√≠an muestras sospechosas a sandbox cloud para an√°lisis.

### 10) Logs, alertas y an√°lisis forense

- Artefactos √∫tiles: logs del AV, procesos y hashes, conexiones de red, eventos de Windows (Event IDs), snapshots, muestras guardadas.
- Flujo: alerta ‚Üí colecci√≥n de evidencia (hash, memoria, network capture) ‚Üí an√°lisis en sandbox / an√°lisis manual ‚Üí remediaci√≥n y IOC distribution.

### 11) Limitaciones y falsos positivos

- **Falsos positivos**: detecciones leg√≠timas; requieren proceso de revisi√≥n/excepciones.
- **0-day**: amenazas nuevas pueden evadir firmas al principio; por eso capas heur√≠stica/behavioral y ML son cr√≠ticas.
- **Privacidad / permisos**: el agente necesita acceso profundo al sistema (escoger proveedores confiables).

### 12) Buenas pr√°cticas de despliegue y operaci√≥n

- Mantener **actualizaciones autom√°ticas** del motor y SO.
- Implementar **copias de seguridad offline/immutable** (mitigaci√≥n ransomware).
- Usar **principio de menor privilegio** y control de cuentas admin.
- Complementar AV con **firewall, filtrado web, EDR y patch management**.
- Configurar **excepciones con cuidado** (no exponer carpetas cr√≠ticas).
- Monitorear alertas y mantener playbooks de respuesta (aislar, investigar, remediar, restaurar).

### 13) Ejemplo de playbook simplificado ante detecci√≥n de malware

1. Aislar host de la red.
2. Ejecutar escaneo completo y guardar logs/muestras.
3. Intentar identificar proceso y hash.
4. Mover archivo a cuarentena y matar proceso.
5. Revisar backups y restaurar ficheros si es necesario.
6. Buscar IOCs en otros endpoints y aplicar remediaci√≥n masiva.
7. Documentar y, si procede, escalar a respuesta a incidentes.

### 14) Resumen pr√°ctico (qu√© recordar)

- El antimalware usa **m√∫ltiples capas**: firmas, heur√≠stica, comportamiento, sandbox y ML.
- **No existe una sola t√©cnica** que lo detecte todo ‚Äî hay que usar varias defensas.
- En empresas, **NGAV + EDR** + backups + patching + formaci√≥n de usuarios = estrategia s√≥lida.
- Monitorea, analiza y valida las alertas para reducir falsos positivos y mejorar detecci√≥n.

---

[üîº](#√≠ndice)

---

| **Inicio**         | **atr√°s 8**               | **Siguiente 10**     |
| ------------------ | ------------------------- | -------------------- |
| [üè†](../README.md) | [‚è™](./12_8_Antivirus.md) | [‚è©](./12_10_EDR.md) |
