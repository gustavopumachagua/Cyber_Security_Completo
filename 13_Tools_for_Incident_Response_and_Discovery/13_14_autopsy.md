| **Inicio**         | **atr√°s 13**            | **Siguiente 15**          |
| ------------------ | ----------------------- | ------------------------- |
| [üè†](../README.md) | [‚è™](./13_13_winhex.md) | [‚è©](./13_15_ipconfig.md) |

---

## **√çndice**

| Temario                                                                  |
| ------------------------------------------------------------------------ |
| [438. Autopsy](#438-autopsy)                                             |
| [439. An√°lisis de disco con Autopsy](#439-an√°lisis-de-disco-con-autopsy) |

# **Autopsy**

## **438. Autopsy**

Perfecto ‚Äî vamos con una **gu√≠a muy completa y pr√°ctica** sobre **Autopsy**, pensada para quien quiere entender qu√© es, para qu√© sirve, c√≥mo funciona en la pr√°ctica, ejemplos de uso y buenas pr√°cticas forenses. Todo en espa√±ol y con comandos y flujos reales (pero siempre desde una √≥ptica legal y defensiva).

---

# ¬øQu√© es Autopsy?

**Autopsy** es una plataforma gr√°fica de an√°lisis forense digital (GUI) construida sobre **The Sleuth Kit (TSK)**. Permite a analistas forenses y a administradores investigar im√°genes de disco, particiones, memorias y otros datos digitales de forma estructurada: b√∫squeda de archivos, recuperaci√≥n de borrados, an√°lisis de actividad del sistema, timeline, an√°lisis de navegadores, correos, m√≥viles, c√°lculos de hashes, y generaci√≥n de informes.

Autopsy combina numerosas **‚Äúingest modules‚Äù** (m√≥dulos de procesamiento) que automatizan la extracci√≥n de artefactos y facilita la navegaci√≥n, filtrado y exportaci√≥n de resultados.

---

# Para qu√© se usa (casos de uso)

- Investigaci√≥n forense de incidentes (compromisos, intrusiones).
- An√°lisis de sospecha de conducta inapropiada (en entornos corporativos con autorizaci√≥n).
- Recuperaci√≥n de archivos borrados y an√°lisis de datos en discos/formats da√±ados.
- Examen de actividad de usuario: navegaci√≥n web, correos, recientes, USB insertados.
- Creaci√≥n de informes para peritajes (con cadena de custodia).

> Siempre con **autorizaci√≥n legal**: usar Autopsy en sistemas de terceros sin permiso es ilegal.

---

# Componentes clave

- **Autopsy (GUI)** ‚Äî interfaz web/desktop para crear casos, ver resultados y generar informes.
- **The Sleuth Kit (TSK)** ‚Äî herramientas de l√≠nea de comando (fls, mmls, icat, ils, istat, etc.) que Autopsy emplea en segundo plano.
- **Ingest modules** ‚Äî m√≥dulos que extraen artefactos: Web History, File Type Identification, EXIF, Email Parser, Hash Lookup, Carving, Recent Activity, Registry Parser (Windows), Mobile apps, etc.
- **Plaso / log2timeline** ‚Äî se integra para timelines avanzados en algunas instalaciones.
- **Hash sets** ‚Äî listas (NSRL, internos) para marcar archivos conocidos/buenos/malos.

---

# Instalaci√≥n (resumen r√°pido)

- **Linux (Ubuntu/Debian)**: instalar Java, The Sleuth Kit, Autopsy (paquete o .deb), dependencias (python, sleuthkit).
- **Windows**: existe instalador MSI con TSK incluido (versiones binarias oficiales).
- **macOS**: soporte m√°s limitado; personalizaciones y builds comunitarias.

(Consulta la documentaci√≥n oficial para la versi√≥n y dependencias exactas antes de instalar).

---

# Flujo de trabajo t√≠pico (paso a paso) ‚Äî Ejemplo pr√°ctico

### 1) Crear un caso

- Abre Autopsy ‚Üí _New Case_ ‚Üí completa metadatos (nombre, investigador, n√∫mero de caso).
- Crea _New Host_ dentro del caso (identificador del dispositivo).

### 2) A√±adir una fuente de datos (Data Source)

- `Add Data Source` ‚Üí seleccionar:

  - **Disk Image or VM file** (raw `.img`, `.dd`, `.e01`, `.aff`, `.VMDK`),
  - **Local disk** (con write-blocker o s√≥lo lectura),
  - **Logical files** o **Memory Image**.

- Elegir m√≥dulos de ingest que quieres ejecutar (por ejemplo: File Type Identification, Extract EXIF, Email Parser, Web History, Recent Activity, Keyword Search, Carving, Hash Lookup).

### 3) Ejecutar ingest (procesamiento)

- Autopsy ejecuta TSK y m√≥dulos; produce artefactos indexados en la base del caso (SQLite/solr dependiendo de la versi√≥n).
- Tiempo: depende del tama√±o y m√≥dulos seleccionados; puedes pausar/retomar.

### 4) Navegar resultados (GUI)

- **Tree** de resultados: _Views_ como File Types, Interesting Items, Extracted Content, Web History, Communications, Recent Activity.
- Haz clic en un artefacto para ver detalles: metadata, hex view, preview (imagen), timeline, associated files.

### 5) Ejemplo: recuperar un JPEG borrado

- En _Views ‚Üí File Types_ filtra por `jpg` y marca `Deleted` o `Carved` files.
- Selecciona archivo ‚Üí `Extract` ‚Üí guarda copia para an√°lisis.
- Verifica integridad (hash) desde la vista de Autopsy.

### 6) Ejemplo: timeline de actividad

- Usa m√≥dulo _Timeline_ (o integra Plaso) para construir una l√≠nea temporal con eventos: archivos modificados, ejecuciones, conexiones web, inserciones USB.
- Ordena y filtra por rangos de tiempo para vincular actividad con un incidente.

### 7) B√∫squeda por palabras clave

- `Keyword Search`: ingresa patrones o expresiones regulares (p.ej. URLs, nombres, correos).
- Puedes usar _Proximity_ y _Context_ para ver l√≠neas alrededor de la coincidencia.

### 8) Hash lookup

- Autopsy compara hashes de archivos contra sets conocidos (NSRL, malware). Marca _known good_ y _known bad_ autom√°ticamente.

### 9) Exportar reportes

- `Generate Report` ‚Üí seleccionar formato (HTML, Excel, XML) ‚Üí incluir artefactos/metadata/evidencia.
- Adjunta hashes, descripciones y capturas de evidencia para cadena de custodia.

---

# Herramientas en segundo plano (TSK) ‚Äî comandos √∫tiles

Autopsy usa TSK internamente; conocer comandos ayuda en diagn√≥stico:

- `mmls image.dd` ‚Äî muestra particiones y offsets.
- `fls -r -m / image.dd` ‚Äî lista archivos y entradas (incluye borrados).
- `icat image.dd inode > file` ‚Äî extrae archivo por inode.
- `ils image.dd` ‚Äî lista inodes.
- `istat image.dd inode` ‚Äî muestra metadata del inode.

**Ejemplo**: listar archivos borrados recursivamente:

```bash
fls -r -m / image.dd | grep deleted
```

---

# M√≥dulos importantes y qu√© extraen

- **File Type Identification** ‚Äî clasifica por tipo/extension.
- **Keyword Search** ‚Äî b√∫squeda textual/regex.
- **Carving** ‚Äî recuperaci√≥n por firmas (JPG, PNG, DOC, ZIP).
- **Web History / Browser Artifacts** ‚Äî historial, cookies, downloads (Chrome, Firefox, IE).
- **Email Parser** ‚Äî PST/EML/MSG parsing.
- **Windows Registry Parser** ‚Äî artefactos de registro (mount points, MRU lists, user activity).
- **Recent Activity** ‚Äî eventos de sistema y usuarios (prefetch, link files).
- **Hash Sets** ‚Äî comparaci√≥n con NSRL u otros sets.
- **Mobile Module** ‚Äî extracci√≥n de artefactos m√≥viles (depende de versi√≥n/plug-ins).

---

# Ejemplo de caso real (escenario simplificado)

**Situaci√≥n:** sospecha de fuga de datos.

1. Imagen del laptop sospechoso.
2. Ingest: Web History, Recent Activity, Keyword Search (palabras clave: ‚Äúconfidencial‚Äù, ‚Äúcontrato‚Äù), Hash Lookup.
3. Resultados: archivo `contract_final.docx` marcado como `deleted` y archivo en USB reciente.
4. Timeline: el documento fue copiado a `/media/usb` a las 02:12 AM ‚Äî correlacionado con login de usuario.
5. Reporte: exportar evidencia (hashes + copias) y timeline para presentaci√≥n al equipo legal.

---

# Buenas pr√°cticas forenses con Autopsy

- **Imagenar primero**: crea imagen forense (E01/RAW) y trabaja sobre la copia.
- **Write-blocker** al examinar discos f√≠sicos.
- **Registrar hashes** (MD5/SHA1/SHA256) antes y despu√©s del an√°lisis.
- **Documentar** cada paso en el caso (qui√©n hizo qu√© y cu√°ndo).
- **Mantener la cadena de custodia** para evidencia judicial.
- **Seleccionar m√≥dulos con cuidado**: algunos pueden ser intrusivos o costosos en tiempo.

---

# Limitaciones y consideraciones

- **Escala**: para im√°genes enormes o an√°lisis masivo en muchas im√°genes, puede requerir hardware potente y optimizaci√≥n.
- **Eficacia del carving**: si un archivo est√° fragmentado, carving b√°sico puede fallar; reconstrucci√≥n manual o herramientas avanzadas necesarias.
- **Evidencia en la nube/m√≥viles**: Autopsy integra ciertos m√≥dulos, pero a menudo necesitar√°s herramientas espec√≠ficas (Mobile/Cloud forensic tools).
- **Actualizaci√≥n de artefactos**: navegadores y formatos cambian; es importante mantener Autopsy y m√≥dulos actualizados.

---

# Integraciones √∫tiles

- **Plaso/Log2timeline** ‚Üí para timelines m√°s ricos.
- **Volatility / Rekall** ‚Üí an√°lisis de memoria (si tienes volcado RAM).
- **YARA** ‚Üí b√∫squeda de firmas de malware.
- **VirusTotal API** ‚Üí marcar artefactos sospechosos.

---

# Ejercicios pr√°cticos para aprender (sugeridos)

1. Crear un caso en Autopsy y a√±adir una imagen `.dd` de prueba (peque√±a).
2. Ejecutar ingest con: File Type Identification, Carving y Recent Activity.
3. Buscar la palabra ‚Äúpassword‚Äù con Keyword Search y revisar artefactos relacionados.
4. Generar un reporte HTML y revisarlo.
5. Usar TSK (`fls`, `icat`) para extraer un archivo particular y compararlo con la salida de Autopsy.

---

# Herramientas alternativas y complementos

- **Autopsy + TSK** es excelente para casos locales.
- **FTK / EnCase** ‚Äî suites comerciales con m√°s integraci√≥n y soporte.
- **Sleuth Kit CLI** ‚Äî cuando prefieras scripting y automatizaci√≥n pura.
- **SIFT Workstation** ‚Äî entorno forense que incluye Autopsy, Plaso, Volatility y m√°s.

---

# Conclusi√≥n

**Autopsy** es una plataforma forense gr√°fica completa, ideal para investigar im√°genes de disco, recuperar archivos, construir timelines, y preparar informes t√©cnicos y legales. Es accesible para principiantes (flujo guiado) pero tambi√©n potente para usuarios avanzados (usa TSK y permite automatizaci√≥n). Para m√°xima eficacia: mant√©n buenas pr√°cticas forenses, actualiza m√≥dulos y complementa con herramientas especializadas (memoria, m√≥vil, cloud) cuando sea necesario.

---

Si quieres, puedo:

- Prepararte un **mini-lab guiado** paso a paso con im√°genes de ejemplo y comandos (crear caso, a√±adir imagen, extraer un archivo borrado).
- Proporcionarte **capturas de pantalla simuladas** y un **checklist forense** imprimible para usar con Autopsy en la pr√°ctica.
- Darte **ejemplos de scripts TSK/Autopsy** para automatizar tareas rutinarias.

¬øQu√© prefieres que haga ahora?

---

[üîº](#√≠ndice)

---

## **439. An√°lisis de disco con Autopsy**

### 1) Preparaci√≥n y buenas pr√°cticas forenses (imperativo)

Antes de tocar cualquier medio:

- **Obtener autorizaci√≥n legal**. Sin permiso, el an√°lisis puede ser ilegal.
- **Trabajar sobre copias**: NUNCA trabajes directamente sobre el disco original; crea una imagen bit-a-bit.
- **Usar write-blocker** si vas a leer directamente desde el disco f√≠sico.
- **Registrar la cadena de custodia**: qui√©n, cu√°ndo, por qu√©; anotar identificadores f√≠sicos, hashes y acciones.
- **Verificar integridad**: calcular MD5/SHA1/SHA256 del original y de la imagen.
- **Etiquetar y documentar** cada paso (capturas, logs).

### 2) Herramientas necesarias (ejemplos)

- **Autopsy** (GUI).
- **The Sleuth Kit (TSK)**: `mmls`, `fls`, `icat`, `istat`, `ils`, etc.
- **ddrescue / dc3dd / dd** para crear im√°genes.
- **md5sum / sha1sum / sha256sum** para hashes.
- Opcionales: **Plaso (log2timeline/psort)** (timeline), **Volatility** (memoria), **Wireshark** (red).

Ejemplo instalaci√≥n (Ubuntu):

```bash
sudo apt update
sudo apt install sleuthkit autopsy libewf-tools plaso
```

(ajusta seg√∫n distribuci√≥n y versi√≥n).

### 3) Crear una imagen forense (paso clave)

Ejemplo usando `ddrescue` (resiliente a errores):

```bash
# identificar disco (ej. /dev/sdb)
lsblk

# crear imagen
sudo ddrescue -n /dev/sdb /mnt/evidence/disk_image.dd /mnt/evidence/ddrescue.log

# calcular hashes
md5sum /mnt/evidence/disk_image.dd > /mnt/evidence/disk_image.md5
sha1sum /mnt/evidence/disk_image.dd > /mnt/evidence/disk_image.sha1
```

Salida ejemplo (hash):

```
d41d8cd98f00b204e9800998ecf8427e  /mnt/evidence/disk_image.dd
```

Documenta estos valores en la cadena de custodia.

### 4) Inspeccionar particiones / offsets (usar TSK)

Averigua particiones y offsets con `mmls`:

```bash
mmls /mnt/evidence/disk_image.dd
```

Salida ejemplo simplificada:

```
DOS Partition Table
Offset Sector: 0
Slot  Start      End        Length     Description
  1  63          206847     206785     NTFS
  2  206848      976773119 976566272  Linux LVM
```

Si necesitas montar una partici√≥n para inspecci√≥n r√°pida (solo lectura):

```bash
# calcular offset = StartSector * 512 (si sector=512 bytes)
sudo mount -o ro,loop,offset=$((206848*512)) /mnt/evidence/disk_image.dd /mnt/mountpoint
```

Pero la pr√°ctica forense recomienda trabajar con Autopsy/TSK en vez de montar y alterar timestamps.

### 5) Crear caso en Autopsy y agregar la imagen

1. Abrir Autopsy ‚Üí **New Case** ‚Üí completar metadatos (investigador, caso).
2. **Add Data Source** ‚Üí seleccionar `Disk Image or VM file` ‚Üí elegir `disk_image.dd`.
3. Seleccionar _Ingest Modules_ a ejecutar (explico abajo cu√°les y por qu√©).
4. Iniciar ingest; Autopsy procesar√° y generar√° artefactos indexados.

**M√≥dulos de ingest recomendados (ejemplo):**

- File Type Identification (clasifica por tipo).
- File Carving (recuperaci√≥n por firma).
- Web Browsers / Web History.
- Recent Activity (Windows artefacts).
- Keyword Search (si proporcionas lista).
- Hash Lookup (compara contra NSRL, malware or set personalizado).
- Email Parser (si aplica).

> Consejo: para grandes im√°genes ejecuta ingest en servidor con recursos suficientes; o ejecuta m√≥dulos selectivos (evita todo a la vez si el tiempo es cr√≠tico).

### 6) Navegar resultados en Autopsy (qu√© mirar)

Tras el ingest encontrar√°s secciones como:

- **File Types** ‚Üí ver archivos por tipo (imagenes, docs, ejecutables).
- **Extracted Content / Carved Content** ‚Üí archivos recuperados por carving.
- **Interesting Items** ‚Üí items marcados por reglas (hash matches, keywords).
- **Web History / Cookies** ‚Üí actividad de navegador.
- **Recent Activity** ‚Üí prefetched apps, USB insertions, etc.
- **Hash Lookup** ‚Üí archivos marcados como conocidos (buenos/maliciosos).
- **Deleted Files** ‚Üí archivos borrados listados (si TSK pudo recuperarlos).

Ejemplo: seleccionar un archivo JPG borrado ‚Üí Autopsy muestra preview, metadata, offset, MFT entry (en Windows), status (deleted), y permite **Extract** para salvar una copia.

### 7) Recuperar archivo borrado (ejemplo pr√°ctico con Autopsy y TSK)

#### Con Autopsy (GUI)

- En _File Types_ o _Deleted Files_ filtrar `jpg` o `docx`.
- Seleccionar archivo marcado como `deleted` ‚Üí bot√≥n **Extract** ‚Üí guardar en carpeta de evidencia.

#### Con TSK CLI (paralela y reproducible)

1. Listar archivos (incluyendo borrados) con `fls`:

```bash
fls -r -m / /mnt/evidence/disk_image.dd > files.txt
# buscar archivos borrados
grep 'r/r' files.txt | head
```

Salida ejemplo (formato `fls`):

```
r/r 128:   Documents/secret.docx
d/d 130:   Pictures
r/r 131:   Pictures/photo001.jpg
```

`r/r` significa archivo regular (deleted) ‚Äî detalles en la manpage de fls.

2. Extraer por inode (o por n√∫mero mostrado por fls) con `icat`:

```bash
# supongamos inode=131 (o el n√∫mero que muestra fls)
icat /mnt/evidence/disk_image.dd 131 > recovered_photo001.jpg
```

3. Ver metadata con `istat`:

```bash
istat /mnt/evidence/disk_image.dd 131
```

Salida ejemplo:

```
Inode: 131
Mode: rw-r--r--   UID: 1000   GID: 1000
Size: 204800
Mac times: mtime: 2025-09-15 02:12:10
```

Documenta y calcula hash del archivo extra√≠do:

```bash
sha256sum recovered_photo001.jpg
```

### 8) Timeline y correlaci√≥n de eventos

Autopsy tiene un m√≥dulo de **Timeline** (o puedes integrar Plaso para m√°s poder).

#### Con Plaso (ejemplo CLI)

1. Crear storage de Plaso:

```bash
log2timeline.py plaso.dump /mnt/evidence/disk_image.dd
```

2. Procesar/filter con `psort`:

```bash
psort.py -o L2tcsv -w timeline.csv plaso.dump "date>=2025-09-14 and date<=2025-09-16"
```

`timeline.csv` contendr√° eventos ordenados; puedes abrirlo en Excel para an√°lisis.

En Autopsy: ver secci√≥n _Timeline_ para ordenar eventos por hora y filtrar por tipo (file create, exec, web visit). Por ejemplo, si el documento `secret.docx` fue copiado a USB a las `02:12`, y el usuario inici√≥ sesi√≥n a `02:10`, correlacionar ambos sugiere acci√≥n humana.

### 9) Carving (recuperaci√≥n por firma)

Autopsy/TSK puede recuperar archivos que no aparecen en sistema de archivos por su firma (e.g., JPEG, PNG, DOCX, ZIP).

- En Autopsy: activa _Carving_ en ingest; despu√©s revisa _Carved_ o _Extracted Content_.
- Con `foremost` o `photorec` (complemento) para carving masivo:

```bash
foremost -t jpg,pdf -i /mnt/evidence/disk_image.dd -o /mnt/evidence/carved_output
```

Nota: archivos fragmentados pueden no recuperar correctamente; carving simple asume archivo contiguo.

### 10) B√∫squeda por palabras clave y YARA

- **Keyword Search**: sube una lista (emails, nombres, frases) y ejecuta b√∫squeda full-text en Autopsy; marca resultados.
- **YARA**: buscar firmas de malware dentro de archivos/imagenes (si Autopsy soporta plugin o integrar YARA externamente).

Ejemplo de b√∫squeda regex en Autopsy (Keyword Search): `pass(word|phrase)|contrase√±a` ‚Äî Autopsy listar√° matches con contexto.

### 11) Hash sets y detecci√≥n (NSRL / malwares)

- Cargar conjuntos de hashes (NSRL goodware, o sets de IOCs) permite que Autopsy marque archivos como _known good_ o _known bad_.
- En Autopsy: **Hash Lookup** module; a√±ade tu set y los archivos se comparan autom√°ticamente durante ingest.

### 12) Exportar evidencia y generar reportes

Autopsy permite:

- **Exportar archivos** recuperados (con metadatos y hashes).
- **Generar reportes** en HTML, CSV o Excel con todas las evidencias seleccionadas, incluyendo timestamps y hashes.
- **Incluir capturas** y notas del analista.

Buen formato de entrega: incluir imagen original (o referencia), hashes, procedimiento, screenshots y items exportados.

### 13) Manejar discos grandes o an√°lisis a gran escala

- Usa un **servidor** (m√°s CPU/RAM/SSD) para Autopsy cuando las im√°genes son grandes.
- Ejecuta ingest por fases (p. ej. primero File Type + Hash Lookup + Recent Activity; despu√©s Carving si necesitas m√°s tiempo).
- Para m√∫ltiples im√°genes, automatiza con TSK + Plaso scripts en lote y luego importa resultados a Autopsy o a BI para revisi√≥n.

### 14) Casos especiales y limitaciones

- **Discos cifrados** (BitLocker, LUKS): sin claves/contrase√±as no podr√°s ver contenido; Autopsy mostrar√° contenedor cifrado. Necesitas credenciales, volcado de memoria con claves, o recuperaci√≥n legal.
- **Sistemas con snapshots / deduplicaci√≥n**: puede requerir pasos adicionales.
- **Archivos fragmentados**: carving puede fallar; reconstrucci√≥n manual o herramientas avanzadas necesarias.
- **Evidencia viva (RAM)**: Autopsy no genera volcados de RAM; usa herramientas especializadas para capturar memoria y luego analiza con Volatility + Autopsy si conviertes datos a formatos compatibles.

### 15) Comandos TSK y ejemplos de uso (resumen)

```bash
# ver particiones
mmls disk_image.dd

# listar archivos (incluidos borrados) con rutas
fls -r -m / disk_image.dd > files.txt

# extraer archivo por inode
icat disk_image.dd 131 > file_from_inode.bin

# metadatos de inode
istat disk_image.dd 131

# listar inodes en un directorio (Linux/EXT)
ils disk_image.dd

# comparar dos im√°genes (byte a byte)
md5sum disk_image.dd other_image.dd
```

### 16) Ejemplo de flujo completo (resumido)

1. **Identificaci√≥n**: registrar y fotografiar medio.
2. **Imagen**: `ddrescue /dev/sdb disk_image.dd ddrescue.log`
3. **Hashes**: `md5sum`, `sha1sum`.
4. **Importar a Autopsy**: New Case ‚Üí Add Data Source ‚Üí seleccionar `disk_image.dd` ‚Üí seleccionar m√≥dulos.
5. **Ingest**: ejecutar y esperar.
6. **Examinar**: File Types ‚Üí Deleted ‚Üí Carving ‚Üí Web History ‚Üí Recent Activity.
7. **Recuperar y exportar**: extraer archivos relevantes con evidencia y hashes.
8. **Timeline**: usar Autopsy/Plaso para correlacionar eventos.
9. **Reportar**: generar reporte con pruebas y cadena de custodia.

### 17) Consejos finales y errores comunes

- **No omitas hashes**: verificaciones garantizan integridad.
- **Documenta TODO**: paso a paso; si es para corte, la documentaci√≥n es crucial.
- **Evita editar la imagen**: trabaja sobre copias de trabajo.
- **Atenci√≥n a husos horarios**: los timestamps pueden estar en UTC; clarifica en tu informe.
- **Si Autopsy no muestra algo** prueba con TSK CLI (m√°s granular) o con herramientas especializadas (Volatility, Plaso, photorec).

---

[üîº](#√≠ndice)

---

| **Inicio**         | **atr√°s 13**            | **Siguiente 15**          |
| ------------------ | ----------------------- | ------------------------- |
| [üè†](../README.md) | [‚è™](./13_13_winhex.md) | [‚è©](./13_15_ipconfig.md) |
