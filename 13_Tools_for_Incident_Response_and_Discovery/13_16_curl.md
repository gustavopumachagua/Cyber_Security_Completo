| **Inicio**         | **atrás 15**              | **Siguiente 17**           |
| ------------------ | ------------------------- | -------------------------- |
| [🏠](../README.md) | [⏪](./13_15_ipconfig.md) | [⏩](./13_17_Wireshark.md) |

---

## **Índice**

| Temario                                                                            |
| ---------------------------------------------------------------------------------- |
| [442. ¿Qué es el comando cURL?](#442-qué-es-el-comando-curl)                       |
| [443. Necesitas saber cómo utilizar cURL](#443-necesitas-saber-cómo-utilizar-curl) |

# **Curl**

## **442. ¿Qué es el comando cURL?**

- **cURL** significa **Client URL**.
- Es una herramienta de línea de comandos usada para **transferir datos** hacia o desde un servidor, utilizando diferentes protocolos de red (HTTP, HTTPS, FTP, SMTP, etc.).
- Permite hacer **peticiones web** directamente desde la terminal, probar APIs, descargar archivos o enviar formularios.
- Está disponible en **Linux, macOS y Windows**.

👉 Piensa en `cURL` como un **navegador en la terminal**, que no muestra gráficos, solo datos.

### 📌 ¿Por qué utilizar `cURL`?

1. **Pruebas rápidas de red**: comprobar si un servidor responde.
2. **Trabajo con APIs**: enviar y recibir datos JSON/XML.
3. **Descargar archivos** sin usar un navegador.
4. **Automatización** en scripts (bash, PowerShell, etc.).
5. **Depuración**: ver encabezados HTTP, códigos de estado, certificados SSL.
6. Funciona con **muchos protocolos**, no solo HTTP/HTTPS.

### 📌 ¿Qué necesitas para utilizar `cURL`?

- **Linux/macOS** → cURL viene preinstalado.
  Verifica con:

  ```bash
  curl --version
  ```

- **Windows** → Desde Windows 10 ya viene incluido. En versiones anteriores se puede instalar manualmente.

### 📌 Sintaxis básica de `cURL`

```
curl [opciones] [URL]
```

Ejemplo mínimo:

```bash
curl https://example.com
```

👉 Descarga el HTML de la página.

Opciones comunes:

- `-o archivo` → Guardar salida en un archivo.
- `-O` → Guardar con el mismo nombre del servidor.
- `-I` → Solo mostrar encabezados HTTP.
- `-L` → Seguir redirecciones.
- `-v` → Modo verbose (detallado).
- `-X` → Especificar método HTTP (GET, POST, PUT, DELETE).
- `-d` → Enviar datos en un POST.
- `-H` → Añadir encabezados personalizados.

### 📌 Ejemplos de comandos `cURL`

#### 1. Obtener el HTML de una web

```bash
curl https://www.google.com
```

#### 2. Descargar un archivo y guardarlo con nombre específico

```bash
curl -o logo.png https://www.example.com/logo.png
```

#### 3. Descargar con el nombre original

```bash
curl -O https://www.example.com/logo.png
```

#### 4. Ver solo los encabezados HTTP

```bash
curl -I https://www.example.com
```

Salida:

```
HTTP/1.1 200 OK
Content-Type: text/html; charset=UTF-8
Content-Length: 1256
```

#### 5. Seguir redirecciones

```bash
curl -L http://example.com
```

#### 6. Hacer una petición POST con datos

```bash
curl -X POST -d "usuario=gustavo&clave=1234" https://api.example.com/login
```

##### 7. Enviar datos JSON a una API

```bash
curl -X POST https://api.example.com/users \
     -H "Content-Type: application/json" \
     -d '{"nombre":"Gustavo","rol":"admin"}'
```

#### 8. Descargar múltiples archivos

```bash
curl -O https://example.com/file1.txt -O https://example.com/file2.txt
```

#### 9. Autenticación con usuario y contraseña

```bash
curl -u usuario:contraseña https://api.example.com/data
```

#### 10. Guardar salida en un archivo log

```bash
curl -v https://example.com > salida.txt 2> debug.log
```

### 📌 Protocolos y formatos compatibles con `cURL`

#### 🔹 Protocolos más usados:

- HTTP / HTTPS
- FTP / FTPS
- SCP / SFTP
- SMTP / IMAP / POP3
- LDAP
- FILE (archivos locales)

#### 🔹 Formatos de datos comunes:

- **HTML** (páginas web)
- **JSON** (APIs REST)
- **XML**
- **Archivos binarios** (imágenes, PDFs, etc.)

### 📌 Salidas del comando `cURL`

Por defecto:

- Imprime la respuesta del servidor en la terminal.
- Puedes redirigirla a un archivo (`-o`).
- Con `-v` o `--verbose` muestra todo el proceso de conexión.
- Con `-w` (`--write-out`) puedes personalizar la salida (ej. solo código HTTP):

  ```bash
  curl -o /dev/null -s -w "%{http_code}\n" https://example.com
  ```

  👉 Esto imprime solo el código de estado (`200`, `404`, etc.).

### 📌 Resumen rápido (Cheat Sheet)

| Uso                                     | Comando                                                             |
| --------------------------------------- | ------------------------------------------------------------------- |
| Ver HTML                                | `curl https://example.com`                                          |
| Descargar archivo con nombre específico | `curl -o archivo.txt URL`                                           |
| Descargar archivo con nombre original   | `curl -O URL`                                                       |
| Ver encabezados HTTP                    | `curl -I URL`                                                       |
| Seguir redirecciones                    | `curl -L URL`                                                       |
| POST con datos                          | `curl -X POST -d "a=1&b=2" URL`                                     |
| POST JSON                               | `curl -X POST -H "Content-Type: application/json" -d '{"x":1}' URL` |
| Autenticación básica                    | `curl -u user:pass URL`                                             |
| Mostrar código HTTP                     | `curl -o /dev/null -s -w "%{http_code}" URL`                        |

✅ **En conclusión**: `cURL` es una herramienta **muy poderosa** para desarrolladores, administradores de sistemas y especialistas en ciberseguridad. Te permite **probar APIs, descargar archivos, depurar problemas de red y automatizar procesos de transferencia de datos**.

---

[🔼](#índice)

---

## **443. Necesitas saber cómo utilizar cURL**

`curl` es la navaja suiza para ejecutar peticiones de red desde la terminal. Si vas a trabajar con APIs, automatizar descargas, depurar conexiones HTTP/S o integrarlo en scripts — dominar `curl` te ahorra horas. Aquí tienes todo lo imprescindible, con ejemplos listos para copiar y adaptar.

### 1) ¿Por qué aprender `curl`?

- Probar APIs REST sin escribir código.
- Descargar/continuar archivos desde consola.
- Depurar cabeceras HTTP, cookies y certificados.
- Automatizar tareas en scripts (CI, backups, monitoreo).
- Trabajar con FTP/SFTP, SMTP u otros protocolos soportados.

### 2) Requisitos / instalación rápida

- Linux/macOS: normalmente ya instalado. Verifica:

```bash
curl --version
```

- Windows 10+: viene incluido; en versiones antiguas instala desde [https://curl.se](https://curl.se).
- Recomiendo además instalar `jq` para procesar JSON (`sudo apt install jq` o `brew install jq`).

### 3) Sintaxis básica

```
curl [OPCIONES] URL
```

Ejemplo mínimo:

```bash
curl https://example.com
```

Por defecto muestra la respuesta en stdout (tu terminal).

### 4) Conceptos y opciones clave (grupo por propósito)

#### Mostrar/guardar respuestas

- `-o archivo` → guardar respuesta en `archivo`.
- `-O` → guardar con el nombre remoto.
- `-s` → silencioso (sin barra de progreso).
- `-S` → mostrar errores cuando `-s` está activo.
- `-#` → mostrar barra de progreso.

Ejemplo:

```bash
curl -L -o index.html https://example.com    # seguir redirecciones y guardar
curl -O https://example.com/files/app.zip     # guardar como app.zip
```

#### Cabeceras y metadatos

- `-I` → sólo encabezados (HEAD request).
- `-i` → encabezados + cuerpo.
- `-H "Header: valor"` → añadir header.

Ejemplo:

```bash
curl -I https://api.example.com
curl -i -H "Accept: application/json" https://api.example.com/resource
```

#### Métodos HTTP y datos

- `-X VERB` → método explícito (GET/POST/PUT/DELETE/PATCH).
- `-d 'a=1&b=2'` → enviar datos (form-urlencoded).
- `--data-urlencode` → codificar valores.
- `-F "file=@mi.jpg"` → multipart/form-data (files).

Ejemplos:

```bash
# POST form
curl -X POST -d "user=juan&pass=secreto" https://api.example.com/login

# POST JSON desde la terminal
curl -X POST https://api.example.com/users \
  -H "Content-Type: application/json" \
  -d '{"name":"María","role":"dev"}'

# POST JSON desde archivo
curl -X POST https://api.example.com/users \
  -H "Content-Type: application/json" \
  -d @payload.json

# Subir archivo multipart
curl -F "avatar=@foto.jpg" -F "user=juan" https://api.example.com/upload
```

#### Autenticación

- Basic auth: `-u usuario:contraseña`.
- Bearer token: `-H "Authorization: Bearer TOKEN"`.
- Certificado cliente: `--cert cert.pem --key key.pem`.

Ejemplos:

```bash
curl -u admin:pass https://service.local/api
curl -H "Authorization: Bearer $TOKEN" https://api.example.com/secure
curl --cert client.pem --key client.key https://secure.example.com
```

#### Cookies

- `--cookie-jar cookies.txt` → guardar cookies.
- `--cookie cookies.txt` → enviar cookies guardadas.

Ejemplo (login con cookies y luego usar sesión):

```bash
curl -c cookies.txt -d "user=ju&pass=1" https://site/login
curl -b cookies.txt https://site/dashboard
```

#### SSL / TLS

- `--insecure` / `-k` → no verificar certificado (evitar en producción).
- `--cacert CA.pem` → usar CA personalizada.

Ejemplo:

```bash
curl --cacert myCA.pem https://internal.example
curl -k https://self-signed.example    # sólo en pruebas
```

#### Redirecciones

- `-L` → seguir redirecciones 3xx.

#### Limitaciones y tiempos

- `--max-time <s>` → tiempo máximo total.
- `--connect-timeout <s>` → tiempo hasta conectar.
- `--retry N` y `--retry-delay S` → reintentar en fallos transitorios.

Ejemplo:

```bash
curl --connect-timeout 5 --max-time 30 --retry 3 --retry-delay 2 https://api.example
```

#### Depuración y logging

- `-v` → verbose (mostrar TLS handshake, headers).
- `--trace trace.txt` → traza completa.
- `--trace-ascii` → traza legible.

Ejemplo:

```bash
curl -v https://api.example.com 2>curl-debug.txt
curl --trace-ascii trace.txt https://api.example.com
```

#### Resumir/limitar descargas

- `-C -` → reanudar descarga desde donde quedó.
- `--limit-rate 200k` → limitar velocidad.

Ejemplo:

```bash
curl -C - -O http://bigfile.example.com/large.iso
curl --limit-rate 500k -O http://server/file.zip
```

#### Protocolos y características extra

- `--ftp-ssl` / `--ssl` / `--sftp` / `--scp` → FTP/SFTP/SCP.
- `--http2` / `--http3` → forzar HTTP/2 o HTTP/3 (si compilado con soporte).
- `--compressed` → solicitar y descomprimir gzip/deflate.

### 5) Ejemplos prácticos según tareas reales

#### A) Comprobar si una API responde y obtener código HTTP

```bash
curl -s -o /dev/null -w "%{http_code} %{time_total}s\n" https://api.example.com/health
# salida: 200 0.123s
```

`-w` (`--write-out`) permite extraer métricas: `%{http_code}`, `%{time_total}`, `%{size_download}`, `%{url_effective}`.

#### B) Obtener JSON y extraer campos con `jq`

```bash
curl -s https://api.example.com/user/42 | jq '.name, .email'
```

#### C) Autenticación OAuth (obtén token y úsalo)

```bash
# 1) solicitar token
TOKEN=$(curl -s -X POST https://auth.example.com/token \
  -d "grant_type=client_credentials&client_id=ID&client_secret=SECRET" | jq -r '.access_token')

# 2) usar token
curl -H "Authorization: Bearer $TOKEN" https://api.example.com/protected
```

#### D) Subir form-data con archivo y campos extras

```bash
curl -F "user=juan" -F "file=@/home/juan/report.pdf" https://upload.example.com
```

#### E) Descargar y reanudar

```bash
curl -C - -O https://example.com/huge.iso
```

#### F) Interactuar vía FTP (descarga anónima)

```bash
curl -O ftp://ftp.example.org/pub/file.tar.gz
```

#### G) Usar proxy

```bash
curl -x http://proxy.company:3128 https://example.com
```

### 6) `curl` en scripts: patrón robusto

Ejemplo de script Bash que llama API y gestiona fallos:

```bash
#!/usr/bin/env bash
set -euo pipefail

URL="https://api.example.com/data"
OUT="/tmp/response.json"

http_code=$(curl -s -w "%{http_code}" -o "$OUT" --max-time 10 --retry 3 "$URL")

if [[ "$http_code" -ne 200 ]]; then
  echo "Error: HTTP $http_code"
  cat "$OUT"
  exit 1
fi

jq '.' "$OUT"
```

Puntos: `-s -w`, comprobar código, salida en archivo temporal y parseo con `jq`.

### 7) Depuración avanzada

- ¿Problemas TLS? `curl -v --trace-ascii trace.txt` y revisar handshake.
- ¿Header faltante? usar `-i` o `-v` para ver headers de request/response.
- ¿Redirecciones extrañas? `-L -v` para seguir y ver cada hop.

### 8) Seguridad y buenas prácticas

- **Nunca** incluyas credenciales en comandos compartidos; usa variables de entorno o archivos con permisos restringidos.
- **Evita** `--insecure` en producción.
- Prefiere tokens con scopes limitados y corta vida.
- Guarda cookies y tokens en archivos con permisos `600`.
- Registra `curl --trace` sólo en entornos seguros (evita filtrar secretos).

### 9) Notas específicas para Windows / PowerShell

- En PowerShell `curl` es alias de `Invoke-WebRequest`. Para ejecutar el binario real usa `curl.exe`.
- Ejemplo PowerShell real con curl.exe:

```powershell
curl.exe -s -o page.html https://example.com
```

### 10) Cheatsheet rápido (comandos útiles)

- GET simple: `curl https://example.com`
- Guardar: `curl -L -o file.html https://example.com`
- Follow redirect: `-L`
- Headers: `-I` (HEAD), `-i` (headers+bodey)
- POST JSON: `-X POST -H "Content-Type: application/json" -d @payload.json URL`
- Multipart: `-F "file=@archivo.jpg"`
- Auth Basic: `-u user:pass`
- Bearer token: `-H "Authorization: Bearer $TOKEN"`
- Resumir: `-C - -O URL`
- Debug: `-v`, `--trace-ascii file`
- SSL insecure: `-k` (no recomendado)
- Timeouts/retries: `--connect-timeout 5 --max-time 30 --retry 3`
- Write-out: `-w "%{http_code} %{time_total}\n"`

### 11) Cosas que **no** hace `curl` (y herramientas complementarias)

- No es un cliente Web interactivo (usa navegador para JS/DOM).
- No maneja tests complejos de APIs con aserciones (usa `httpie`, `Postman`, `pytest + requests` u otras).
- Para análisis de tokens/flow OAuth, combina `curl` con `jq` y scripts.

### 12) Ejercicio práctico corto para empezar

1. Obtener status de una API:

```bash
curl -s -o /dev/null -w "%{http_code} %{time_total}\n" https://api.github.com
```

2. Hacer POST JSON (simulado):

```bash
curl -X POST https://httpbin.org/post \
  -H "Content-Type: application/json" \
  -d '{"test":123}' | jq .
```

3. Descargar archivo y reanudar:

```bash
curl -C - -O https://speed.hetzner.de/1GB.bin
```

---

[🔼](#índice)

---

| **Inicio**         | **atrás 15**              | **Siguiente 17**           |
| ------------------ | ------------------------- | -------------------------- |
| [🏠](../README.md) | [⏪](./13_15_ipconfig.md) | [⏩](./13_17_Wireshark.md) |
