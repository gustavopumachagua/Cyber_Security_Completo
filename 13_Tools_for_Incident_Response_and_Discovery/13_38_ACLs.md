| **Inicio**         | **atr√°s 37**               | **Siguiente 39**          |
| ------------------ | -------------------------- | ------------------------- |
| [üè†](../README.md) | [‚è™](./13_37_Sinkholes.md) | [‚è©](./13_39_Patching.md) |

---

## **√çndice**

| Temario                                                                                                              |
| -------------------------------------------------------------------------------------------------------------------- |
| [484. Lista de control de acceso: definici√≥n, tipos y usos](#484-lista-de-control-de-acceso-definici√≥n-tipos-y-usos) |
| [485. Listas de control de acceso](#485-listas-de-control-de-acceso)                                                 |

# **ACLs**

## **484. Lista de control de acceso: definici√≥n, tipos y usos**

![ACLs](/img/13_Tools_for_Incident_Response_and_Discovery/ACLs.webp "ACLs")

### üîπ 1. Lista de control de acceso (ACL) definida

Una **Lista de Control de Acceso (ACL, Access Control List)** es un conjunto de reglas que **define qu√© usuarios, grupos o dispositivos tienen permitido o denegado el acceso a un recurso espec√≠fico**.
Ese recurso puede ser un **archivo, directorio, dispositivo de red, puerto, servicio o aplicaci√≥n**.

üëâ Analog√≠a:

Piensa en la ACL como la **lista de invitados de una fiesta**:

- Si tu nombre est√° en la lista ‚Üí entras.
- Si no ‚Üí el guardia te bloquea.

### üîπ 2. Tipos de listas de control de acceso

#### ‚úÖ a) ACL en sistemas operativos (archivos y carpetas)

Controla qui√©n puede **leer, escribir, ejecutar o eliminar** un archivo.

Ejemplo en Linux:

```bash
# Dar permisos de lectura al usuario pedro en archivo.txt
setfacl -m u:pedro:r archivo.txt
```

Ejemplo en Windows:

- Una carpeta de Recursos Humanos puede estar configurada para que solo el grupo "HR" tenga acceso.

#### ‚úÖ b) ACL en redes (routers, switches, firewalls)

Controla el **tr√°fico de red** (permitir o bloquear paquetes) basado en:

- Direcci√≥n IP de origen/destino
- Puerto (ej. 80 = HTTP, 443 = HTTPS)
- Protocolo (TCP, UDP, ICMP)

Ejemplo en un router Cisco:

```cisco
access-list 100 deny tcp any any eq 23
access-list 100 permit ip any any
```

‚û°Ô∏è Esto bloquea Telnet (puerto 23) y permite el resto del tr√°fico.

#### ‚úÖ c) ACL est√°ndar y extendida en redes

- **Est√°ndar** ‚Üí solo filtra por **IP origen**.
- **Extendida** ‚Üí filtra por **IP origen, IP destino, protocolo y puerto** (m√°s granular).

Ejemplo:

- ACL est√°ndar: bloquear tr√°fico de `192.168.1.10` hacia cualquier destino.
- ACL extendida: permitir solo tr√°fico **HTTP (puerto 80)** desde `192.168.1.0/24` hacia el servidor `10.0.0.5`.

#### ‚úÖ d) ACL din√°micas y reflexivas

- **Din√°micas**: se crean temporalmente cuando un usuario se autentica.
- **Reflexivas**: permiten conexiones de retorno. Ejemplo: si inicias una conexi√≥n web, permite la respuesta del servidor.

### üîπ 3. ¬øPor qu√© utilizar una ACL?

Las ACL se usan para:

- **Seguridad** ‚Üí evitar accesos no autorizados a archivos/redes.
- **Segmentaci√≥n** ‚Üí separar tr√°fico entre departamentos (ej. Finanzas vs Marketing).
- **Rendimiento** ‚Üí reducir tr√°fico innecesario en la red.
- **Cumplimiento normativo** ‚Üí garantizar que solo usuarios autorizados accedan a datos sensibles.

Ejemplo:

Un banco aplica ACLs para que solo el equipo de finanzas acceda a servidores con datos contables.

### üîπ 4. C√≥mo funcionan las listas de control de acceso

1. El sistema recibe una solicitud de acceso (a un archivo, carpeta, recurso o red).
2. Consulta la ACL del recurso.
3. La ACL tiene reglas de **permitir (permit)** o **denegar (deny)** en orden.
4. La primera regla que coincide se aplica.
5. Si ninguna regla coincide, se aplica la **pol√≠tica por defecto** (generalmente _deny_).

üëâ Ejemplo en red:

Un firewall recibe un paquete:

- Si la ACL dice "permitir HTTP a servidor 10.0.0.5" ‚Üí lo deja pasar.
- Si la ACL dice "denegar todo lo dem√°s" ‚Üí bloquea el resto.

### üîπ 5. Mejores pr√°cticas para el uso de ACL

- üìå **Principio de privilegio m√≠nimo** ‚Üí solo permitir lo necesario.
- üìå **Orden correcto** ‚Üí las reglas se leen de arriba hacia abajo.
- üìå **Pol√≠tica por defecto = denegar** ‚Üí bloquea todo y solo permite lo que se necesita.
- üìå **Documentar las reglas** ‚Üí evita confusiones al administrarlas.
- üìå **Revisar y auditar peri√≥dicamente** ‚Üí para eliminar reglas obsoletas.

### üîπ 6. RBAC frente a ACL

- **ACL (Access Control List)**

  - Define permisos **por usuario o recurso espec√≠fico**.
  - M√°s granular pero puede ser dif√≠cil de administrar en entornos grandes.
  - Ejemplo: "Pedro puede leer archivo.txt".

- **RBAC (Role-Based Access Control)**

  - Los permisos se asignan a **roles**, y los usuarios obtienen permisos al pertenecer a un rol.
  - M√°s escalable en empresas grandes.
  - Ejemplo: "Usuarios con rol _Finanzas_ pueden leer archivos contables".

üëâ Diferencia clave:

ACL = permisos individuales.
RBAC = permisos por rol (m√°s simple y escalable).

### üîπ 7. Recursos adicionales

- [Cisco ACL Configuration Guide](https://www.cisco.com/c/en/us/support/docs/security-vpn/access-control-lists-acls/26448-ACLsamples.html)
- [Microsoft Docs - File and Folder ACLs](https://docs.microsoft.com/en-us/windows/win32/secauthz/access-control-lists)
- \[NIST SP 800-162: Attribute Based Access Control (ABAC)]

‚úÖ **En resumen**:

Las **ACL son herramientas fundamentales en seguridad inform√°tica**. Permiten **decidir qui√©n puede acceder a qu√© recurso y c√≥mo**, ya sea en archivos, directorios o redes. Son muy √∫tiles para **controlar accesos, proteger informaci√≥n sensible y filtrar tr√°fico**, aunque deben usarse con buenas pr√°cticas para no complicar la administraci√≥n.

---

[üîº](#√≠ndice)

---

## **485. Listas de control de acceso**

### 1 ‚Äî ¬øQu√© es una ACL (definici√≥n)

Una **Lista de Control de Acceso (ACL)** es un conjunto ordenado de **reglas** que determina **qu√© sujeto** (usuario, grupo, host, red) **puede o no puede realizar una acci√≥n** (leer, escribir, ejecutar, conectar) sobre un **objeto** (archivo, carpeta, interfaz de red, puerto, recurso en la nube).

- En sistemas de ficheros, una ACL especifica permisos por usuario/grupo sobre un archivo/carpeta.
- En redes, una ACL se usa para permitir/denegar paquetes basados en IP/protocolo/puerto.
- Muchas plataformas (cloud, DBs, apps) tienen su propia forma de ACL.

### 2 ‚Äî Por qu√© usar ACLs

- **Control fino**: permisos a nivel de usuario/grupo o por flujo de red.
- **Seguridad**: aplicar principio de m√≠nimo privilegio.
- **Segmentaci√≥n**: separar funciones y recursos.
- **Auditor√≠a**: registrar qui√©n accede a qu√© (si se habilita logging).

### 3 ‚Äî Tipos principales de ACL (resumen)

#### A. ACLs de sistema de archivos

- **NTFS (Windows)**: ACLs con ACE (Access Control Entries) ‚Äî permiten Allow/Deny, heredadas, control por usuario/grupo.
- **POSIX + POSIX-ACL (Linux/UNIX)**: propietario, grupo, others + ACLs extendidas (setfacl/getfacl).
- **ACLs cloud / objetos**: S3 ACLs o bucket policies (JSON) en AWS, permisos de Blob en Azure.

#### B. ACLs de red

- **Simple (est√°ndar)**: filtra por IP origen.
- **Extendida**: filtra por IP origen/destino, protocolo, puertos.
- **Reflexiva / din√°mica**: permite tr√°fico de retorno (stateful behavior).
- **NACL (cloud)**: stateless network ACLs (ej. AWS NACL).
- **Security Groups (cloud)**: stateful, funcionan como firewalls a nivel de instancia.

#### C. ACLs de aplicaci√≥n / base de datos

- Control de privilegios por rol/usuario sobre tablas, filas o recursos (p. ej. Oracle VPD, SQL Server permissions).

### 4 ‚Äî C√≥mo funcionan (conceptos clave)

- **Orden**: en muchas implementaciones (ej. Cisco, iptables) las reglas se procesan **de arriba hacia abajo** y la primera coincidencia decide (first-match).
- **Acci√≥n por defecto**: normalmente _deny_ (rechazar) si ninguna regla coincide, pero algunos sistemas usan _allow_ por defecto.
- **Deny vs Allow**: en sistemas de ficheros **una ACE Deny explicit suele tener prioridad sobre una ACE Allow** ‚Äî presta atenci√≥n a la precedencia.
- **Herencia**: en ficheros y AD, las ACLs pueden heredarse a subcarpetas/archivos; esto facilita pero tambi√©n complica el debugging.
- **Stateful vs Stateless**: NACLs de cloud son **stateless** (hay que definir entrada y salida), Security Groups son **stateful** (la respuesta est√° impl√≠citamente permitida).

### 5 ‚Äî ACLs en sistemas de ficheros ‚Äî ejemplos pr√°cticos

#### Windows (NTFS) ‚Äî `icacls`

Dar permisos de **Modificar** al grupo `HR` sobre `C:\Data\HR`, con herencia:

```powershell
icacls "C:\Data\HR" /grant "MYDOMAIN\HR:(OI)(CI)M"
```

- `OI` = Object Inherit, `CI` = Container Inherit, `M` = Modify.
  Quitar permisos:

```powershell
icacls "C:\Data\HR" /remove "MYDOMAIN\Alice"
```

Comprobar ACLs:

```powershell
icacls "C:\Data\HR"
```

Ver ‚Äúeffective access‚Äù desde GUI: Propiedades ‚Üí Seguridad ‚Üí Avanzado ‚Üí Effective Access.

Tambi√©n con PowerShell:

```powershell
Get-Acl "C:\Data\HR" | Format-List
```

y para asignar:

```powershell
$acl = Get-Acl "C:\Data\HR"
$rule = New-Object System.Security.AccessControl.FileSystemAccessRule("MYDOMAIN\HR","Modify","ContainerInherit,ObjectInherit","None","Allow")
$acl.AddAccessRule($rule)
Set-Acl "C:\Data\HR" $acl
```

#### Linux (POSIX ACL) ‚Äî `setfacl`, `getfacl`

Dar rwx a usuario `ana` y dar lectura a grupo `hr`:

```bash
sudo setfacl -m u:ana:rwx /srv/hr
sudo setfacl -m g:hr:r-x /srv/hr
getfacl /srv/hr
```

Dar ACL por defecto para nuevas entradas (heredada):

```bash
sudo setfacl -d -m g:hr:r-x /srv/hr
```

Eliminar ACL:

```bash
sudo setfacl -x u:ana /srv/hr
```

Si no hay ACL, rigen permisos tradicionales (owner/group/others).

### 6 ‚Äî ACLs en redes ‚Äî ejemplos pr√°cticos

#### Cisco IOS ‚Äî est√°ndar y extendida (first-match)

**ACL est√°ndar (filtra s√≥lo origen):**

```cisco
access-list 10 permit 192.168.1.0 0.0.0.255
interface GigabitEthernet0/0
 ip access-group 10 in
```

**ACL extendida (filtra por proto/puertos):**

```cisco
access-list 100 permit tcp 192.168.1.0 0.0.0.255 host 10.0.0.5 eq 80
access-list 100 deny ip any any
interface GigabitEthernet0/1
 ip access-group 100 in
```

En IOS **la primera l√≠nea que coincide se aplica**. Nota: `host 10.0.0.5` = exact IP.

**Named ACL (m√°s legible):**

```cisco
ip access-list extended WEB
 permit tcp 192.168.1.0 0.0.0.255 host 10.0.0.5 eq 80
 deny ip any any
```

#### iptables (Linux legacy)

Permitir SSH solo desde la subred de administraci√≥n:

```bash
sudo iptables -A INPUT -p tcp --dport 22 -s 172.16.1.0/24 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 22 -j DROP
```

Ver reglas:

```bash
sudo iptables -L -v -n
```

Guardar reglas (var√≠a seg√∫n distro): `iptables-save`.

#### nftables (moderno)

```bash
sudo nft add table inet filter
sudo nft 'add chain inet filter input { type filter hook input priority 0 ; }'
sudo nft add rule inet filter input tcp dport 80 accept
sudo nft add rule inet filter input tcp dport 22 ip saddr 172.16.1.0/24 accept
sudo nft add rule inet filter input drop
```

#### AWS ‚Äî Security Group vs NACL

- **Security Group** = stateful, se aplica a instancias. Ejemplo: permitir HTTP:

  - Inbound: TCP 80 0.0.0.0/0
  - Outbound: all (por defecto)

- **Network ACL (NACL)** = stateless, se aplica a subredes y necesita entradas para inbound y outbound:

  - Rule 100: ALLOW TCP 80 0.0.0.0/0 (inbound)
  - Rule 101: ALLOW TCP ephemeral ports 1024-65535 0.0.0.0/0 (outbound)
  - Rule 200: DENY all 0.0.0.0/0

### 7 ‚Äî ACLs en la nube y S3 (ejemplo S3 bucket policy JSON)

S3 usa _bucket policy_ o ACLs; ejemplo de pol√≠tica que permite GetObject a un usuario:

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Principal": { "AWS": "arn:aws:iam::123456789012:user/Ana" },
      "Action": "s3:GetObject",
      "Resource": "arn:aws:s3:::mi-bucket/*"
    }
  ]
}
```

(En AWS, hoy se prefiere usar pol√≠ticas y roles en vez de ACLs p√∫blicas.)

### 8 ‚Äî Principios y buenas pr√°cticas al dise√±ar ACLs

1. **Principio de menor privilegio**: da el m√≠nimo acceso necesario.
2. **Usa grupos/roles, no usuarios individuales** para simplificar administraci√≥n.
3. **Evita usar Deny salvo cuando sea imprescindible**; Deny complica troubleshooting.
4. **Orden l√≥gico en ACLs de red** (reglas generales al final).
5. **Documenta cada regla** (prop√≥sito, autor, fecha, ticket).
6. **Automatiza control** con IaC (Terraform, Ansible) para evitar configuraci√≥n en silos.
7. **Auditor√≠a y logging**: activa logs para cambios y accesos fallidos.
8. **Revisi√≥n peri√≥dica** (housekeeping): elimina reglas obsoletas.
9. **Pruebas en entorno controlado** antes de aplicar en producci√≥n.
10. **Backup y versionado** de pol√≠ticas/ACLs.

### 9 ‚Äî Problemas comunes y c√≥mo depurarlos

#### Problema: ‚ÄúUn usuario no puede abrir un archivo aunque tiene permisos‚Äù

- Verifica **effective permissions** (permisos efectivos pueden resultarse por combinaci√≥n de grupos y Deny).
- Revisa **herencia**: quiz√° una ACE padre deniegue.
- Comprueba si existe alg√∫n **SACL**/audit que muestre intentos y errores.

#### Problema: ‚ÄúConexi√≥n bloqueada desde Internet‚Äù

- En redes: `show access-lists` (Cisco) o `iptables -L -v -n`.
- Test desde cliente externo: `nc -vz public-ip 80` o `nmap -p 80 public-ip`.
- Si cloud: revisa NACL y Security Group (ambos tienen que permitir si aplica).
- Verifica NAT/port-forwarding en router.

#### Herramientas de diagn√≥stico

- **Sistemas de ficheros**: `icacls`, `Get-Acl`, `getfacl`, `getenforce` (SELinux).
- **Red**: `ping`, `traceroute`, `telnet`/`nc`, `nmap`, `tcpdump/wireshark`.
- **Cloud**: logs de VPC Flow (AWS), NSG Flow logs (Azure), CloudTrail.

### 10 ‚Äî ACL vs RBAC vs ABAC (comparaci√≥n r√°pida)

- **ACL**: permisos por recurso para usuarios/grupos (bueno para control fino).
- **RBAC (Role-Based Access Control)**: permisos asignados a roles; usuarios obtienen permisos por pertenecer a roles (escalable).
- **ABAC (Attribute-Based Access Control)**: reglas basadas en atributos (usuario, recurso, entorno). Muy flexible para pol√≠ticas din√°micas.

En la pr√°ctica, **se combinan**: p. ej. AD con roles (RBAC) + NTFS ACLs por carpeta + GPOs.

### 11 ‚Äî Plantillas / ejemplos de uso reales (r√°pido)

#### A ‚Äî ACL de ficheros (HR)

- Requisito: carpeta `\\fileserver\HR` accesible solo por grupo `DOMAIN\HR` (lectura/escritura) y `DOMAIN\Managers` (FullControl).
  Windows (icacls):

```powershell
icacls "\\fileserver\HR" /grant "MYDOMAIN\HR:(OI)(CI)M" "MYDOMAIN\Managers:(OI)(CI)F"
icacls "\\fileserver\HR" /remove "MYDOMAIN\Everyone"
```

#### B ‚Äî ACL de red (permitir web y RDP desde admin net)

- Requisito: permitir HTTP/HTTPS a webserver, permitir RDP solo desde red de administraci√≥n 172.16.1.0/24.
  Cisco:

```cisco
ip access-list extended WEB-RDP
 permit tcp any host 10.0.0.5 eq 80
 permit tcp any host 10.0.0.5 eq 443
 permit tcp 172.16.1.0 0.0.0.255 host 10.0.0.5 eq 3389
 deny ip any any
```

#### C ‚Äî AWS Security Group (example)

- Inbound rules:

  - TCP 80 0.0.0.0/0
  - TCP 443 0.0.0.0/0
  - TCP 3389 172.16.1.0/24
    (Ejecutarlo desde la consola de AWS o Terraform.)

### 12 ‚Äî Auditor√≠a y cumplimiento

- En sistemas Windows, habilita **object access auditing** (GPO) y revisa event logs (Security ID 4663, 4670).
- En redes, habilita logs de firewall y VPC Flow Logs; env√≠a a SIEM para correlaci√≥n.
- Audita cambios en ACLs: qui√©n cre√≥/cambi√≥/qui√©n aprob√≥.

### 13 ‚Äî Resumen / checklist r√°pido

- Usa **grupos** y **roles**, no usuarios individuales.
- **Documenta** cada regla (prop√≥sito y due√±o).
- Prefiere **allow** expl√≠cito y deny por defecto.
- Haz **backups** y versionado de ACLs.
- **Prueba** y **monitorea** cambios.
- Revisa permisos peri√≥dicamente y automatiza el despliegue donde sea posible.

---

[üîº](#√≠ndice)

---

| **Inicio**         | **atr√°s 37**               | **Siguiente 39**          |
| ------------------ | -------------------------- | ------------------------- |
| [üè†](../README.md) | [‚è™](./13_37_Sinkholes.md) | [‚è©](./13_39_Patching.md) |
